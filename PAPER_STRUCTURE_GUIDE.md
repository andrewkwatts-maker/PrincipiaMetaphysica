# Principia Metaphysica Paper Structure Quick Reference

**Last Updated:** 2025-12-29
**Paper Version:** 16.0

---

## File Locations

| File | Path | Purpose |
|------|------|---------|
| **Paper HTML** | `Pages/paper.html` | Main paper page |
| **Paper Renderer** | `js/pm-paper-renderer.js` | Dynamic rendering engine |
| **Data Source** | `AutoGenerated/theory_output.json` | All paper content |
| **Formulas** | `AutoGenerated/formulas.json` | Formula metadata (also in theory_output) |
| **Parameters** | `AutoGenerated/parameters.json` | Parameter values (also in theory_output) |
| **Sections** | `AutoGenerated/sections.json` | Section data (also in theory_output) |

---

## Paper Sections

### Main Sections (1-7)

| # | Title | Content Blocks | Formulas | Status |
|---|-------|----------------|----------|--------|
| 1 | Introduction | 56 | 0 refs | ✅ Complete |
| 2 | The Pneuma Lagrangian | 99 | 2 refs | ✅ Complete |
| 3 | Gauge Coupling Unification | 15 | 6 refs | ✅ Complete |
| 4 | Neutrino Mixing from G2 | 11 | 4 refs | ✅ Complete |
| 5 | Multi-Sector Cosmology | 7 | 4 refs | ✅ Complete |
| 6 | Falsifiable Predictions (SME) | 79 | 0 refs | ✅ Complete |
| 7 | Discussion & Conclusions | 154 | 0 refs | ✅ Complete |

### Appendices (A-N + special)

| ID | Title | Content | Status |
|----|-------|---------|--------|
| 8 | Appendix N: G2 Topology Landscape | 9 blocks | ✅ Partial |
| A | Mathematical Framework | 2 blocks | ⚠️ Placeholder |
| B | G2 Holonomy Details | 2 blocks | ⚠️ Placeholder |
| C | Gauge Coupling RG Flow | 2 blocks | ⚠️ Placeholder |
| D | Neutrino Sector Details | 2 blocks | ⚠️ Placeholder |
| E | Proton Decay Calculations | 2 blocks | ⚠️ Placeholder |
| F | Cosmological Predictions | 2 blocks | ⚠️ Placeholder |
| G | Wolfram Proofs | 2 blocks | ⚠️ Placeholder |
| H | Experimental Validation | 2 blocks | ⚠️ Placeholder |
| I | Numerical Methods | 2 blocks | ⚠️ Placeholder |
| J | Parameter Tables | 2 blocks | ⚠️ Placeholder |
| K | Derivation Chains | 2 blocks | ⚠️ Placeholder |
| L | Mirror Sector Analysis | 2 blocks | ⚠️ Placeholder |
| M | Moduli Stabilization | 2 blocks | ⚠️ Placeholder |
| N | Future Directions | 2 blocks | ⚠️ Placeholder |
| thermal-time | Thermal Time Hypothesis | 8 blocks | ✅ Partial |

---

## Content Block Types

### Supported in Renderer

```json
{
  "type": "paragraph",
  "content": "Text content here..."
}
```

**Available Types:**
- `paragraph`, `text` - Standard paragraphs
- `heading` - Section headings (with level 1-6)
- `equation`, `formula` - Mathematical formulas
- `list` - Ordered or unordered lists
- `table` - Data tables with headers and rows
- `code` - Code blocks with syntax highlighting
- `quote`, `blockquote` - Quotations
- `note` - Academic notes/asides
- `highlight_box` - Highlighted information
- `definition` - Mathematical definitions
- `theorem` - Theorem blocks
- `proof` - Proof blocks with QED symbol
- `remark` - Remarks/observations
- `example` - Worked examples
- `derivation`, `derivation_box` - Derivation steps
- `callout`, `info_box` - Information callouts

---

## Formula System

### Current Issue (CRITICAL)

**Problem:** Formula blocks use `content` instead of `formulaId`

**Wrong:**
```json
{
  "type": "formula",
  "content": "S = ∫ d^26 X √(-G) [R + ...]",
  "label": "Main Equation"
}
```

**Correct:**
```json
{
  "type": "equation",
  "formulaId": "pneuma-lagrangian",
  "label": "(2.1)"
}
```

### Formula Metadata Structure

Each formula in `formulas` object has:

```json
"pneuma-lagrangian": {
  "id": "pneuma-lagrangian",
  "label": "(2.1)",
  "latex": "\\mathcal{L}_{\\text{pneuma}} = ...",
  "plain_text": "L_pneuma = ...",
  "category": "THEORY",
  "description": "Full Pneuma Lagrangian...",
  "input_params": ["topology.chi_eff", "topology.b3"],
  "output_params": ["pneuma.coupling"],
  "derivation": {
    "steps": ["Step 1...", "Step 2..."],
    "references": ["Paper 1", "Paper 2"]
  },
  "terms": {
    "kinetic": "\\frac{1}{2} \\partial_\\mu ...",
    "potential": "V(\\Psi_P) = ..."
  }
}
```

### Formula Categories

- `THEORY` - Core theoretical predictions
- `DERIVED` - Derived from fundamental principles
- `ESTABLISHED` - Well-established results from literature
- `PREDICTION` - Novel predictions to be tested
- `EXPERIMENTAL` - Experimental measurements

---

## Parameter System

### Parameter Structure

```json
"gauge.M_GUT": {
  "value": 1.23e16,
  "source": "GEOMETRIC",
  "uncertainty": 0.05e16,
  "status": "DERIVED",
  "metadata": {...},
  "derivation_chain": [...]
}
```

### Parameter Categories

**Established:**
- `constants.*` - Fundamental constants (M_PLANCK, alpha_em, etc.)
- `pdg.*` - PDG measured values
- `nufit.*` - NuFIT neutrino parameters
- `desi.*`, `planck.*` - Cosmological measurements

**Geometric:**
- `topology.*` - Topological invariants
- `chirality.*` - Chiral properties

**Derived:**
- `gauge.*` - GUT scale, couplings
- `fermion.*` - Fermion properties
- `cosmology.*` - Cosmological predictions
- `proton_decay.*` - Proton decay predictions

### Using Parameters in Content

**Method 1: data-pm-value attribute**
```html
<span data-pm-value="gauge.M_GUT" data-format="scientific:2"></span>
```

**Method 2: PM.get() in JavaScript**
```javascript
const value = PM.get('gauge.M_GUT');
```

**Format Options:**
- `scientific:N` - Scientific notation with N decimals
- `fixed:N` - Fixed point with N decimals
- `percent` - As percentage
- `integer` - Round to integer

---

## Rendering Process

### 1. Page Load Sequence

```
1. Load paper.html
2. Load MathJax configuration
3. Load pm-constants-loader.js
4. Load pm-formula-loader.js
5. Load pm-paper-renderer.js
6. DOM Content Loaded event:
   a. Load theory_output.json
   b. Render title and metadata
   c. Render abstract
   d. Render table of contents
   e. Render all sections
   f. Process formulas
   g. Process parameters
   h. Process equation references
   i. Trigger MathJax typesetting
7. Display paper
```

### 2. Section Rendering

For each section:
```
1. Create section element with ID
2. Render section header (number + title)
3. Render section abstract (if present)
4. Render content blocks:
   - For each block, call renderContentBlock()
   - Handle special types (equation, table, etc.)
5. Process formulas (replace data-formula-id)
6. Process parameters (replace data-pm-value)
7. Process equation cross-references
8. Return section element
```

### 3. Formula Rendering

When encountering `formulaId`:
```
1. Get formula from formulas object
2. Extract equation number from label
3. Create equation wrapper with anchor ID
4. Render LaTeX content
5. Render plain text fallback
6. Render terms definitions
7. Render description
8. Render expandable metadata panel:
   - Input/output parameters
   - Derivation steps
   - References
   - Category
   - Values (experimental vs computed)
   - Notes
9. Return complete equation HTML
```

---

## Common Tasks

### Adding a New Section

1. Add to `theory_output.json`:
```json
"sections": {
  "9": {
    "id": "9",
    "type": "section",
    "title": "New Section",
    "abstract": "Section abstract...",
    "contentBlocks": [...]
  }
}
```

2. Paper renderer will auto-detect and render

### Adding a New Formula

1. Add to `formulas` object:
```json
"formulas": {
  "my-formula": {
    "id": "my-formula",
    "label": "(9.1)",
    "latex": "...",
    "section": "9",
    ...
  }
}
```

2. Reference in section:
```json
{
  "type": "equation",
  "formulaId": "my-formula"
}
```

### Adding a New Parameter

1. Add to `parameters` object:
```json
"parameters": {
  "category.param_name": {
    "value": 123.456,
    "source": "DERIVED",
    ...
  }
}
```

2. Use in content:
```html
The value is <span data-pm-value="category.param_name" data-format="scientific:2"></span>
```

### Adding a Table

```json
{
  "type": "table",
  "headers": ["Column 1", "Column 2", "Column 3"],
  "rows": [
    ["Row 1 Col 1", "Row 1 Col 2", "Row 1 Col 3"],
    ["Row 2 Col 1", "Row 2 Col 2", "Row 2 Col 3"]
  ]
}
```

### Adding a Derivation

```json
{
  "type": "derivation_box",
  "title": "Derivation of Equation (X.Y)",
  "content": "<p>Step 1: Start with...</p><p>Step 2: Apply...</p>"
}
```

---

## Styling

### CSS Files

- `css/pm-common.css` - Common styles
- `css/pm-glass-theme.css` - Glass morphism theme
- `css/pm-header.css` - Header navigation
- `css/pm-scientific-typography.css` - Academic typography

### Key CSS Classes

**Sections:**
- `.paper-section` - Section container
- `.section-header` - Section header
- `.section-title` - Section title
- `.section-number` - Section number
- `.section-abstract` - Section abstract

**Formulas:**
- `.equation-wrapper` - Equation container
- `.equation-line` - Equation + number line
- `.equation-content` - LaTeX content
- `.equation-number` - Equation number (e.g., "(2.1)")
- `.equation-terms` - Terms definitions
- `.equation-discussion` - Description text
- `.equation-metadata-panel` - Expandable metadata

**Academic:**
- `.theorem-block` - Theorem
- `.proof-block` - Proof
- `.definition-block` - Definition
- `.remark-block` - Remark
- `.example-block` - Example

---

## Debugging

### Console Commands

**Check if data loaded:**
```javascript
PMPaperRenderer.loaded  // Should be true
PMPaperRenderer.data    // Should show theory_output data
```

**Get formula by ID:**
```javascript
PMPaperRenderer.data.formulas['pneuma-lagrangian']
```

**Get parameter value:**
```javascript
PM.get('gauge.M_GUT')
```

**Re-render section:**
```javascript
const section = await PMPaperRenderer.renderSection(
  PMPaperRenderer.data.sections['2']
);
document.getElementById('section-2').replaceWith(section);
```

### Common Issues

**Formulas not rendering:**
- Check if `formulaId` is set (not `content`)
- Check if formula exists in `formulas` object
- Check console for errors

**MathJax not rendering:**
- Check MathJax loaded (window.MathJax)
- Manually trigger: `MathJax.typesetPromise()`
- Check LaTeX syntax

**Parameters showing "?":**
- Check parameter exists: `PM.get('param.name')`
- Check `data-pm-value` attribute spelling
- Check PM loaded: `window.PM`

---

## API Reference

### PMPaperRenderer

**Methods:**
- `renderPaper(containerId, options)` - Render complete paper
- `renderSection(section, options)` - Render single section
- `renderFormula(formulaId)` - Render formula by ID
- `processFormulas(container)` - Process formula placeholders
- `processParameters(container)` - Process parameter placeholders
- `typesetMathJax(element)` - Trigger MathJax on element

**Properties:**
- `data` - Loaded theory_output data
- `loaded` - Boolean, true if data loaded

### PM (Constants/Parameters)

**Methods:**
- `PM.load()` - Load parameter data
- `PM.get(path)` - Get parameter value
- `PM.formula(id)` - Get formula by ID

---

## Performance

### Load Times (Typical)

- theory_output.json: ~500ms
- Paper rendering: ~1000ms
- MathJax typesetting: ~2000ms
- **Total:** ~3.5 seconds

### Optimization Tips

1. Use `debug: false` in production
2. Enable caching for theory_output.json
3. Lazy-load appendices
4. Use CDN for MathJax
5. Minimize reflows during rendering

---

## Version History

| Version | Date | Changes |
|---------|------|---------|
| 16.0 | 2025-12-29 | Current version, 23 sections, 96 formulas |
| 15.0 | 2025-12-28 | Added thermal-time section |
| 14.0 | 2025-12-27 | Expanded Section 7 |
| ... | ... | ... |

---

**End of Guide**
