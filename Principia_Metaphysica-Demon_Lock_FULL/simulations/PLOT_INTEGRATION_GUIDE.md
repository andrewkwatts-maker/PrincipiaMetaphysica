# PM v16.1 Plot Integration Guide

## Overview

This guide shows how to integrate the publication plotting system with the broader Principia Metaphysica workflow.

## Quick Start

### 1. Generate Theory Data (if needed)

```bash
cd simulations/v21
python section1_foundation_v16_0.py
python section2_topology_v16_0.py
# ... run other sections ...
python appendix_a_technical_v16_0.py
```

This creates `AutoGenerated/theory_output.json` with all predictions.

### 2. Generate Plots

```bash
cd ../..
python simulations/generate_pm_plots_v16_1.py
```

This creates four publication plots in `AutoGenerated/plots/`.

### 3. Validate Results

```bash
python simulations/validate_plots_v16_1.py
```

This verifies data integrity and calculates agreement statistics.

## Integration Points

### With Simulation Pipeline

The plotting system integrates seamlessly with the existing simulation framework:

```python
# In your main simulation script
from simulations.generate_pm_plots_v16_1 import generate_all_plots

# Run simulations
run_all_sections()

# Generate plots from results
generate_all_plots("AutoGenerated/theory_output.json")
```

### With Website Renderer

The plots can be referenced in HTML templates:

```javascript
// In PM-PAPER-RENDERER.js
const PLOT_FILES = {
    neutrino: 'AutoGenerated/plots/neutrino_mixing_contours_v16_1.png',
    hubble: 'AutoGenerated/plots/hubble_tension_v16_1.png',
    evolution: 'AutoGenerated/plots/hubble_evolution_v16_1.png',
    residuals: 'AutoGenerated/plots/theory_residuals_v16_1.png'
};

function insertPlot(plotKey, containerId) {
    const img = document.createElement('img');
    img.src = PLOT_FILES[plotKey];
    img.alt = `PM v16.1 ${plotKey} plot`;
    img.style.maxWidth = '100%';
    document.getElementById(containerId).appendChild(img);
}
```

### With LaTeX Paper

Include in your main paper:

```latex
\documentclass{article}
\usepackage{graphicx}

\begin{document}

\section{Predictions}

\subsection{Neutrino Mixing}

The geometric prediction for neutrino mixing parameters is shown in
Figure~\ref{fig:neutrino}, where our model prediction (red X) lies
within the 3$\sigma$ contours from NuFIT 6.0.

\begin{figure}[htbp]
  \centering
  \includegraphics[width=0.9\textwidth]{AutoGenerated/plots/neutrino_mixing_contours_v16_1.png}
  \caption{Neutrino mixing parameters: PM v16.1 prediction compared to
           NuFIT 6.0 global fit constraints for Normal Ordering (blue)
           and Inverted Ordering (green).}
  \label{fig:neutrino}
\end{figure}

\subsection{Cosmology}

The Hubble tension resolution is shown in Figure~\ref{fig:hubble}...

\end{document}
```

## Automation

### CI/CD Integration

Add to `.github/workflows/generate_plots.yml`:

```yaml
name: Generate Publication Plots

on:
  push:
    paths:
      - 'simulations/v21/*.py'
      - 'AutoGenerated/theory_output.json'

jobs:
  plots:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.13'
      - name: Install dependencies
        run: |
          pip install matplotlib numpy
      - name: Generate plots
        run: |
          python simulations/generate_pm_plots_v16_1.py
      - name: Validate plots
        run: |
          python simulations/validate_plots_v16_1.py
      - name: Upload artifacts
        uses: actions/upload-artifact@v3
        with:
          name: publication-plots
          path: AutoGenerated/plots/*.png
```

### Make Integration

Add to `Makefile`:

```makefile
.PHONY: plots validate-plots clean-plots

plots: AutoGenerated/theory_output.json
	python simulations/generate_pm_plots_v16_1.py

validate-plots: plots
	python simulations/validate_plots_v16_1.py

clean-plots:
	rm -f AutoGenerated/plots/*.png
	rm -rf AutoGenerated/plots/custom/
	rm -f AutoGenerated/plots/test_*.png
	rm -f AutoGenerated/plots/example_*.png

all: plots validate-plots
```

Usage:
```bash
make plots          # Generate all plots
make validate-plots # Generate and validate
make clean-plots    # Remove all generated plots
```

## Custom Workflows

### Generating Plots with Different Theory Versions

```python
from simulations.generate_pm_plots_v16_1 import (
    plot_neutrino_mixing_contours,
    plot_hubble_tension,
    load_theory_data
)

# Load v16.1 data
data_v16_1 = load_theory_data("AutoGenerated/theory_output_v16_1.json")

# Load v16.0 data for comparison
data_v16_0 = load_theory_data("AutoGenerated/theory_output_v16_0.json")

# Generate comparison plots
plot_neutrino_mixing_contours(
    output_path="plots/neutrino_v16_1.png",
    theory_data=data_v16_1
)

plot_neutrino_mixing_contours(
    output_path="plots/neutrino_v16_0.png",
    theory_data=data_v16_0
)
```

### Batch Processing Multiple Configurations

```python
import json
from pathlib import Path
from simulations.generate_pm_plots_v16_1 import generate_all_plots

# Process multiple configurations
configs = [
    "config_default.json",
    "config_alternate_moduli.json",
    "config_high_ede.json"
]

for config_file in configs:
    config_name = Path(config_file).stem
    output_dir = f"AutoGenerated/plots/{config_name}/"

    # Generate plots for this configuration
    generate_all_plots(config_file)

    print(f"Generated plots for {config_name}")
```

### Programmatic Plot Customization

```python
from simulations.generate_pm_plots_v16_1 import (
    plot_theory_residuals,
    load_theory_data
)
import matplotlib.pyplot as plt

# Load data
theory_data = load_theory_data()

# Generate base plot
plot_theory_residuals(
    output_path="AutoGenerated/plots/residuals_custom.png",
    theory_data=theory_data
)

# Or customize further
fig, ax = plt.subplots(figsize=(10, 6))
# ... custom plotting code ...
plt.savefig("AutoGenerated/plots/residuals_very_custom.png", dpi=300)
```

## Data Flow

```
┌─────────────────────────────────────────────────────────────┐
│  PM Simulation Pipeline                                      │
│                                                               │
│  section1_foundation_v16_0.py                                │
│  section2_topology_v16_0.py                                  │
│  section3_gauge_v16_0.py                                     │
│  section4_fermions_v16_0.py                                  │
│  section5_yukawa_v16_0.py                                    │
│  section6_cosmology_v16_0.py                                 │
│  appendix_*_v16_0.py                                         │
│                                                               │
└─────────────────┬───────────────────────────────────────────┘
                  │
                  ▼
    ┌─────────────────────────────┐
    │  theory_output.json          │
    │  - All predictions            │
    │  - All parameters             │
    │  - All metadata               │
    └─────────────┬───────────────┘
                  │
                  ▼
    ┌─────────────────────────────┐
    │  generate_pm_plots_v16_1.py  │
    │  - Load theory data           │
    │  - Generate 4 plots           │
    │  - 300 DPI PNG output         │
    └─────────────┬───────────────┘
                  │
                  ▼
    ┌─────────────────────────────┐
    │  AutoGenerated/plots/        │
    │  - neutrino_mixing_*.png     │
    │  - hubble_tension_*.png      │
    │  - hubble_evolution_*.png    │
    │  - theory_residuals_*.png    │
    └─────────────┬───────────────┘
                  │
                  ├──────────────────┐
                  │                  │
                  ▼                  ▼
    ┌──────────────────┐  ┌──────────────────┐
    │  LaTeX Paper      │  │  Website         │
    │  - Figures        │  │  - Images        │
    │  - Tables         │  │  - Interactive   │
    └──────────────────┘  └──────────────────┘
```

## Best Practices

### 1. Always Validate After Generation

```bash
python simulations/generate_pm_plots_v16_1.py && \
python simulations/validate_plots_v16_1.py
```

### 2. Version Your Plot Files

```bash
# Save timestamped copies for records
cp AutoGenerated/plots/neutrino_mixing_contours_v16_1.png \
   archive/plots/neutrino_$(date +%Y%m%d).png
```

### 3. Check File Sizes

Large deviations may indicate rendering issues:
```bash
du -h AutoGenerated/plots/*.png | awk '$1 !~ /^1[0-9][0-9]K|^2[0-9][0-9]K/ {print "WARNING:", $0}'
```

### 4. Use Consistent Naming

Follow the pattern: `{description}_v{version}.png`
- `neutrino_mixing_contours_v16_1.png`
- `hubble_tension_v16_1.png`

### 5. Document Plot Changes

When modifying plots, update:
- `PM_PLOTS_README.md` (user documentation)
- `PLOTTING_SYSTEM_SUMMARY.md` (technical summary)
- Git commit messages with plot examples

## Troubleshooting

### Plot Generation Fails

**Issue:** `matplotlib not found`
```bash
pip install matplotlib numpy
```

**Issue:** `theory_output.json not found`
```bash
# Run simulation pipeline first
cd simulations/v21
python section1_foundation_v16_0.py
# ... etc
```

**Issue:** Unicode errors on Windows
```python
# Already handled in code with ASCII fallbacks
# If still seeing errors, set environment:
set PYTHONIOENCODING=utf-8
```

### Plot Quality Issues

**Issue:** Plots look pixelated
- Check DPI is set to 300 in output
- Verify `savefig.dpi` in rcParams

**Issue:** Text overlapping
- Increase figure size
- Adjust `plt.tight_layout()`
- Manually set `bbox_inches='tight'`

**Issue:** Wrong colors
- Verify color-blind friendly palette
- Check matplotlib backend supports true color

## Performance

### Benchmarks

On typical hardware (2024-era laptop):
- Single plot generation: ~1-2 seconds
- All 4 plots: ~5-8 seconds
- Validation: <1 second
- Total workflow: <10 seconds

### Optimization

For faster batch processing:
```python
import multiprocessing as mp
from functools import partial

# Parallel plot generation
plots = [plot_neutrino_mixing_contours, plot_hubble_tension, ...]
with mp.Pool(4) as pool:
    pool.map(lambda f: f(), plots)
```

## Future Enhancements

### Planned Features

1. **Interactive Plots** (Q1 2026)
   - Plotly/Bokeh versions
   - Zoom, pan, hover tooltips
   - Real-time data updates

2. **Automated Captions** (Q2 2026)
   - Generate LaTeX captions from metadata
   - Include statistical summaries
   - Reference relevant equations

3. **Multi-format Export** (Q2 2026)
   - PDF (vector graphics)
   - SVG (web scalable)
   - EPS (legacy journals)

4. **Plot Comparison Tool** (Q3 2026)
   - Side-by-side v16.0 vs v16.1
   - Difference highlighting
   - Improvement metrics

## Support

For issues or questions:
- Check documentation in `PM_PLOTS_README.md`
- Run validation script to diagnose problems
- Review example code in `test_individual_plots.py`

## License

Copyright (c) 2025-2026 Andrew Keith Watts. All rights reserved.

---

**Last Updated:** 2025-12-29
**Version:** 16.1
