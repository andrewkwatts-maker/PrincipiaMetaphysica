#!/usr/bin/env python3
"""
Migrate gauge theory foundations content from HTML to foundations_data.json
"""

import json
import os
from pathlib import Path

# Define the project root
PROJECT_ROOT = Path(r"h:\Github\PrincipiaMetaphysica")
JSON_PATH = PROJECT_ROOT / "AutoGenerated" / "foundations_data.json"
HTML_FILES = [
    PROJECT_ROOT / "foundations" / "yang-mills.html",
    PROJECT_ROOT / "foundations" / "so10-gut.html"
]

def load_json():
    """Load existing foundations data"""
    with open(JSON_PATH, 'r', encoding='utf-8') as f:
        return json.load(f)

def save_json(data):
    """Save updated foundations data"""
    with open(JSON_PATH, 'w', encoding='utf-8') as f:
        json.dump(data, f, indent=2, ensure_ascii=False)

def check_migration_status():
    """Check what content exists and what needs migration"""
    data = load_json()

    print("=" * 80)
    print("GAUGE THEORY FOUNDATIONS MIGRATION STATUS")
    print("=" * 80)

    # Check for yang-mills
    yang_mills_found = False
    so10_found = False

    for category_key, category_data in data.get('foundations', {}).items():
        for item in category_data.get('items', []):
            if item.get('id') == 'yang-mills':
                yang_mills_found = True
                print("\n[OK] Yang-Mills Theory found in JSON:")
                print(f"  Category: {category_key}")
                print(f"  Title: {item.get('title')}")
                print(f"  Has link: {item.get('link')}")

            if item.get('id') == 'so10-gut':
                so10_found = True
                print("\n[OK] SO(10) GUT found in JSON:")
                print(f"  Category: {category_key}")
                print(f"  Title: {item.get('title')}")
                print(f"  Has link: {item.get('link')}")

    print("\n" + "-" * 80)
    print("HTML Files Status:")
    print("-" * 80)

    for html_file in HTML_FILES:
        exists = html_file.exists()
        size = html_file.stat().st_size if exists else 0
        status = "[OK] EXISTS" if exists else "[MISSING]"
        print(f"{status}: {html_file.name} ({size:,} bytes)")

    print("\n" + "=" * 80)
    print("ANALYSIS:")
    print("=" * 80)

    if yang_mills_found and so10_found:
        print("[OK] Both entries already exist in foundations_data.json")
        print("  They currently link to HTML files: yang-mills.html and so10-gut.html")
        print("\nRECOMMENDATION:")
        print("  The HTML files contain rich educational content (diagrams, explanations,")
        print("  resources, practice problems) that should remain accessible.")
        print("  The JSON entries serve as metadata/index pointing to these HTML pages.")
        print("\n  SUGGESTED ACTION: Keep the HTML files as educational resources.")
        print("  The current architecture already supports this via the 'link' field.")
    else:
        print("[MISSING] Missing entries in JSON - need to add metadata")
        if not yang_mills_found:
            print("  - Yang-Mills Theory not in JSON")
        if not so10_found:
            print("  - SO(10) GUT not in JSON")

    return {
        'yang_mills_in_json': yang_mills_found,
        'so10_in_json': so10_found,
        'html_files_exist': all(f.exists() for f in HTML_FILES)
    }

if __name__ == '__main__':
    status = check_migration_status()

    print("\n" + "=" * 80)
    print("CONCLUSION:")
    print("=" * 80)

    if status['yang_mills_in_json'] and status['so10_in_json']:
        print("[OK] Migration already complete!")
        print("  Both gauge theory foundations are properly indexed in JSON.")
        print("  HTML files provide the detailed educational content.")
        print("\n  No further action needed - current architecture is correct.")
    else:
        print("[ACTION NEEDED] Entries need to be added to foundations_data.json")
