# Validation Pipeline Assessment Report

**Version:** 17.2
**Date:** 2026-01-10
**Author:** Claude Code Pipeline Analysis

## Executive Summary

This report assesses the current validation pipeline for Principia Metaphysica, identifying what exists, what's missing, and recommendations for improvement.

---

## 1. Current Validation Scripts

### 1.1 Read-Only Scripts (Safe to Run)

| Script | Purpose | Risk |
|--------|---------|------|
| `validate_config_usage.py` | Scans for hardcoded parameter values | None |
| `validate_links.py` | Validates links in visualization pages | None |
| `validate_html_params.py` | Validates HTML parameter references | None |
| `validate_variable_names.py` | Checks for outdated variable references | None |
| `validate_param_theoretical_values.py` | Ensures params have theoretical/experimental values | None |
| `check_remaining_issues.py` | Checks for encoding issues | None |

### 1.2 Report-Generating Scripts (Write to reports/ only)

| Script | Purpose | Output Files |
|--------|---------|--------------|
| `validate_equation_numbering.py` | Validates equation numbering | `reports/equation-numbering-validation.md` |
| `validate_72_gates.py` | Validates 72 Gates via Wolfram | `AutoGenerated/wolfram_results.json` |
| `validate_all.py` | Combined validation | `AutoGenerated/wolfram_results.json` |
| `validate_wolfram_http.py` | Validates formulas via Wolfram | `AutoGenerated/wolfram_results.json` |
| `audit_hardcoded_values.py` | Audits hardcoded JS values | `reports/hardcoded_values_audit.json` |
| `audit_pm_values_in_paper.py` | Audits PM values in paper | `reports/pm_values_audit.json` |

### 1.3 Scripts That Can Modify Source Files (DANGER)

| Script | Purpose | Risk | Safe Mode |
|--------|---------|------|-----------|
| `validate_latex.py` | Validates LaTeX/MathJax | HIGH with `--fix` | Run without `--fix` flag |

---

## 2. Validation Coverage Analysis

### 2.1 What We HAVE

| Category | Coverage | Scripts |
|----------|----------|---------|
| PM Parameter Values | GOOD | `validate_param_theoretical_values.py`, `validate_html_params.py` |
| Equation Numbering | GOOD | `validate_equation_numbering.py` |
| LaTeX Syntax | PARTIAL | `validate_latex.py` (basic checks) |
| Link Validation | PARTIAL | `validate_links.py` (visualization pages only) |
| Hardcoded Values | PARTIAL | `audit_hardcoded_values.py` (JS only) |
| 72 Gates Verification | GOOD | `validate_72_gates.py`, `validate_all.py` |
| Variable Names | GOOD | `validate_variable_names.py` |
| Anti-Tautology | GOOD | Built into `run_all_simulations.py` |

### 2.2 What We're MISSING

| Category | Status | Priority | Recommendation |
|----------|--------|----------|----------------|
| MathJax Render Test | MISSING | HIGH | Add headless browser test |
| Bidirectional Links | MISSING | HIGH | Validate formula→param and param→formula refs |
| Schema Validation | MISSING | HIGH | JSON Schema for sections/formulas/params |
| Hardcoded Values Whitelist | MISSING | MEDIUM | Add allowed values list |
| Deprecated Params Blacklist | MISSING | HIGH | Track superseded PM params |
| Param Registration Order | MISSING | MEDIUM | Track sigma by registration |
| Python Simulation Values | PARTIAL | MEDIUM | Extend hardcoded audit to .py |
| Cross-File Consistency | MISSING | HIGH | Ensure SSOT across all outputs |

---

## 3. SSOT (Single Source of Truth) Analysis

### 3.1 Current SSOT Chain

```
FormulasRegistry.py (VERSION, constants)
       ↓
run_all_simulations.py
       ↓
   ┌───┴───────────────────────────────┐
   ↓                                   ↓
PMRegistry                      AutoGenerated/
   ↓                               ├── parameters.json
Parameter                          ├── formulas.json
definitions                        ├── statistics.json
   ↓                               ├── metadata.json
inject_outputs()                   ├── sections.json
   ↓                               └── theory_output.json
parameters.json
```

### 3.2 SSOT Compliance Issues Found

1. **Version Source**: `system.version` now properly flows from `FormulasRegistry.VERSION`
2. **Uncertainty Flow**: Fixed - now propagates from Parameter definitions to registry
3. **Status Preservation**: Fixed - ESTABLISHED/SYSTEM statuses now preserved
4. **testable_count**: Added - computed field for 72-30=42 testable gates

---

## 4. Recommended New Validations

### 4.1 Priority 1 (Immediate)

1. **Bidirectional Link Validator**
   - Check: Every formula references valid params
   - Check: Every param is referenced by at least one formula
   - Check: No orphaned references

2. **Schema Validator**
   - JSON Schema for `parameters.json` structure
   - JSON Schema for `formulas.json` structure
   - JSON Schema for `sections.json` structure

3. **Deprecated Param Blacklist**
   - List of old param paths that should no longer be used
   - Mapping to replacement params
   - Fail if deprecated params are found in HTML/JS

### 4.2 Priority 2 (Next Sprint)

4. **Hardcoded Values Whitelist**
   - Allow known mathematical constants (pi, e, sqrt(2))
   - Allow dimensional constants with explicit units
   - Reject any value that matches a PM param

5. **MathJax Render Validator**
   - Use headless browser to actually render formulas
   - Check for rendering errors
   - Validate output dimensions

6. **Sigma by Registration Order**
   - Add registration sequence number to param metadata
   - Report high-sigma params ordered by when they were registered
   - Identify root causes of sigma propagation

---

## 5. Current Pipeline Execution Order

```
1. run_all_simulations.py
   ├── Load ESTABLISHED physics
   ├── Run simulations by phase (0-6)
   ├── Register params via inject_outputs()
   ├── Run anti-tautology validation
   └── Generate AutoGenerated/*.json

2. scripts/generate_statistics.py
   └── Compute validation statistics from certificates

3. Manual validation scripts (as needed)
   ├── validate_param_theoretical_values.py
   ├── validate_latex.py (NO --fix)
   ├── validate_links.py
   └── validate_html_params.py
```

---

## 6. Recommendations

### 6.1 Immediate Actions

1. Create `scripts/validate_bidirectional_refs.py`
2. Create `scripts/validate_param_schema.py`
3. Create `config/deprecated_params.json` with blacklist
4. Create `config/allowed_hardcoded_values.json` with whitelist
5. Add `registration_order` field to PM param metadata

### 6.2 Pipeline Improvements

1. Add pre-commit hook to run read-only validations
2. Create `scripts/validate_pipeline.py` that runs all safe validators
3. Add CI/CD integration for validation on push

### 6.3 Documentation

1. Document SSOT chain in README
2. Add validation instructions to contributing guide
3. Create validation failure troubleshooting guide

---

## 7. Script Safety Matrix

| Script | Read-Only | Writes Reports | Modifies Source |
|--------|-----------|----------------|-----------------|
| validate_config_usage.py | YES | NO | NO |
| validate_links.py | YES | NO | NO |
| validate_html_params.py | YES | NO | NO |
| validate_variable_names.py | YES | NO | NO |
| validate_param_theoretical_values.py | YES | NO | NO |
| check_remaining_issues.py | YES | NO | NO |
| validate_equation_numbering.py | NO | YES | NO |
| validate_72_gates.py | NO | YES | NO |
| validate_all.py | NO | YES | NO |
| validate_wolfram_http.py | NO | YES | NO |
| audit_hardcoded_values.py | NO | YES | NO |
| audit_pm_values_in_paper.py | NO | YES | NO |
| validate_latex.py | YES (default) | NO | YES (with --fix) |

---

## 8. Next Steps

1. [ ] Implement bidirectional link validator
2. [ ] Create JSON schemas for AutoGenerated files
3. [ ] Create deprecated param blacklist
4. [ ] Create hardcoded values whitelist
5. [ ] Add registration order to param metadata
6. [ ] Create unified `validate_pipeline.py` script
7. [ ] Add pre-commit hooks for validation
