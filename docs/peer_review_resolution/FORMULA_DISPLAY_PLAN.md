# Formula Display Enhancement Plan

*Generated: 2026-01-17*
*Status: IMPLEMENTED - Gemini Reviewed*

---

## Implementation Summary (2026-01-17)

### Completed Tasks:
1. **Python Generator** (`scripts/generate_interactive_html.py`)
   - Creates HTML with .formula-var spans for each term
   - Hand-crafted HTML for key formulas (master action, three-generations, euler-characteristic)
   - Auto-generated HTML for 169 formulas with terms metadata

2. **formulas.html Changes**
   - Modified `renderInteractiveFormula()` to prioritize HTML when available
   - Fallback: html → LaTeX → plain text

3. **index.html Changes**
   - Added 26D Pneuma Master Action section (1.1) with THEORY badge
   - All 7 terms have hover tooltips with descriptions
   - Key terms are clickable links to paper sections

### Validation:
- 169/320 formulas now have interactive HTML
- 175/320 formulas have terms metadata
- Key formulas verified: pneuma-master-action-v18, three-generations, euler-characteristic, betti-numbers, dark-energy-eos, proton-lifetime

---

## Executive Summary

Two tasks to align the website with the simulation's master action formula:
1. Ensure index.html shows the correct 26D master action from the simulation
2. Add interactive hover tooltips to formulas.html like index.html has

---

## Current State Analysis

### Index.html Master Action (lines 876-1019)
- Currently shows the **13D Shadow Action** (S_13D) - the reduced form
- Has interactive hover tooltips on `.formula-var` elements
- Tooltip structure: `.var-name`, `.var-description`, `.var-units`, `.var-contribution`
- Expandable breakdown with dimensional reduction (26D → 13D → 4D)

### AutoGenerated/formulas.json (pneuma-master-action-v18)
```json
{
  "id": "pneuma-master-action-v18",
  "label": "(1.1)",
  "latex": "S = \\int d^{26}X \\sqrt{-G} \\left[ R + \\bar{\\Psi}_P (i \\Gamma^M D_M - m) \\Psi_P + \\lambda (\\bar{\\Psi}_P \\Psi_P)^2 + g \\, t_{\\text{ortho}} \\, \\bar{\\Psi}_P \\Psi_P + \\mathcal{L}_{\\text{Sp}(2,\\mathbb{R})} \\right]",
  "terms": {
    "R": "26D Einstein-Hilbert scalar curvature",
    "Psi_P": "8192-component Pneuma spinor from Cl(24,2)",
    "Gamma^M": "26D gamma matrices",
    "D_M": "Covariant derivative with spin connection",
    "lambda": "Quartic self-interaction for condensation",
    "t_ortho": "Orthogonal time direction coupling",
    "L_Sp(2,R)": "Sp(2,R) gauge fixing (2T physics)"
  }
}
```

### Simulation (master_action_simulation_v18.py)
- Defines identical formula with same LaTeX and terms
- This is the authoritative source

### Pages/formulas.html
- Has CSS for `.formula-var` and `.var-tooltip` (lines 1152-1257)
- Has `wrapFormulaTermsWithTooltips()` function (line 2192)
- BUT: Only works for HTML formulas, not LaTeX
- `renderInteractiveFormula()` prioritizes LaTeX, so hover tooltips don't apply

---

## Identified Gaps

### Gap 1: Index.html Shows 13D Action, Not 26D Master Action
- The dimensional reduction section is good
- But we should ALSO show the full 26D master action at the top
- The 26D action is S = ∫d²⁶X√(-G)[R + Ψ̄_P(iΓ^M D_M - m)Ψ_P + λ(Ψ̄_PΨ_P)² + g·t_ortho·Ψ̄_PΨ_P + ℒ_Sp(2,ℝ)]

### Gap 2: Formulas.html Doesn't Have Interactive Hover for LaTeX
- LaTeX rendered via MathJax doesn't support hover
- The terms data exists but only shown in expandable section
- Need a hybrid approach: show interactive HTML formula with hover, then LaTeX below

### Gap 3: Some Formulas Missing Complete Terms Metadata
- Master action has good terms
- Need to verify key formulas have terms for hover display

---

## Implementation Plan

### Task 1: Update Index.html Master Action Section

**Goal**: Add the full 26D Pneuma master action with interactive hover terms BEFORE the dimensional reduction section.

**Changes**:
1. Add a new section showing the 26D master action formula
2. Use HTML with `.formula-var` elements for each term
3. Each term gets a `.var-tooltip` with:
   - `.var-name`: Symbol name (e.g., "R - Ricci Scalar")
   - `.var-description`: Description from formulas.json terms
   - `.var-units`: Physical units
   - Link to paper section

**Structure**:
```html
<div class="expandable-formula" id="26d-master-action">
  <div class="formula-header">
    <h3>26D Pneuma Master Action (1.1)</h3>
    <span class="category-badge">THEORY</span>
  </div>
  <div class="formula-display">
    <span class="formula-var">S</span>
    <span class="formula-op">=</span>
    <span class="formula-var">∫d²⁶X</span>
    <span class="formula-var">√(-G)</span>
    <span class="formula-op">[</span>
    <span class="formula-var" data-term="R">R</span>
    <!-- ... each term with hover tooltip ... -->
  </div>
</div>
```

### Task 2: Enhance Formulas.html with Interactive Formula Display

**Goal**: For formulas with terms metadata, show interactive HTML version with hover, not just LaTeX.

**Changes**:
1. Modify `renderInteractiveFormula()` to check for terms metadata
2. If formula has `html` field AND `terms`, use the HTML with hover tooltips
3. If formula only has `latex`, show LaTeX but add a "Terms" expandable below
4. For master action specifically, add `html` field with interactive markup

**New renderInteractiveFormula logic**:
```javascript
function renderInteractiveFormula(formula) {
    // Check if we have interactive HTML with terms
    if (formula.html && formula.terms && Object.keys(formula.terms).length > 0) {
        return wrapFormulaTermsWithTooltips(formula.html, formula.terms);
    }

    // For LaTeX formulas, render with MathJax but add terms section below
    if (formula.latex) {
        return `$$${formula.latex}$$`;
    }

    // Fallback
    return escapeHtml(formula.plain_text || 'No equation');
}
```

### Task 3: Add html Field to Key Formulas in formulas.json

**Goal**: Add interactive HTML representation for key formulas.

**Formulas to enhance**:
1. pneuma-master-action-v18 (master action)
2. three-generations (n_gen = χ_eff/48)
3. euler-characteristic (χ_eff formula)
4. betti-numbers (b₃ = 24)
5. Key gauge sector formulas (QCD, Weak, Hypercharge)

**HTML format for terms**:
```html
<span class="formula-var" data-term="R">R</span>
```

The `wrapFormulaTermsWithTooltips()` function will then find matching terms in the `terms` object and add tooltips.

---

## Verification Steps

1. After implementation, verify:
   - Index.html shows 26D master action with all 7 terms having hover tooltips
   - Formulas.html master action card has interactive hover on terms
   - Terms shown match formulas.json exactly

2. Cross-check with simulation:
   - `simulations/v16/master_action/master_action_simulation_v18.py`
   - Verify LaTeX matches exactly

3. Test hover functionality:
   - Each term shows tooltip on hover
   - Tooltip shows name, description, units
   - Links work correctly

---

## Questions for Gemini Review

1. Should we show both 26D and 13D actions on index.html, or replace 13D with 26D?
2. Should formulas.html prioritize interactive HTML over LaTeX rendering when terms exist?
3. What additional formulas beyond master action should have interactive HTML added?
4. Should we add `html` field to formulas.json via Python generator or manually?

---

## Risk Assessment

| Risk | Mitigation |
|------|------------|
| Breaking existing hover on index.html | Keep existing 13D section, add 26D above |
| MathJax conflicts with hover CSS | Use separate div for interactive vs LaTeX |
| Terms mismatch between sources | Use formulas.json as single source of truth |
| Performance with many hover elements | Already works on index.html, same approach |

---

*Plan ready for Gemini review.*
