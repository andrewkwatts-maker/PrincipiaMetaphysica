<!DOCTYPE html>
<!--
    Copyright (c) 2025 Andrew Keith Watts. All rights reserved.

    This is the intellectual property of Andrew Keith Watts. Unauthorized
    reproduction, distribution, or modification of this code, in whole or in part,
    without the express written permission of Andrew Keith Watts is strictly prohibited.

    For inquiries, please contact AndrewKWatts@Gmail.com
-->

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Foundational Physics - The established equations that underpin Principia Metaphysica">
    <title>Foundational Physics - Principia Metaphysica</title>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="/css/auth.css">
    <script src="../js/formula-expansion.js" defer></script>
    <script src="../theory-constants-enhanced.js"></script>
    <script src="../js/pm-tooltip-system.js"></script>
    <style>
        /* Intro Section with Frosted Glass */
        .intro {
            background: rgba(26, 31, 58, 0.6);
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            padding: 2rem;
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            margin-bottom: 2rem;
        }

        /* Section Cards with Frosted Glass */
        .section-card {
            background: rgba(26, 31, 58, 0.6);
            backdrop-filter: blur(12px) saturate(180%);
            -webkit-backdrop-filter: blur(12px) saturate(180%);
            padding: 1.5rem;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            text-decoration: none;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            display: block;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
        }

        .section-card:hover {
            transform: translateY(-8px) scale(1.02);
            backdrop-filter: blur(20px) saturate(200%);
            -webkit-backdrop-filter: blur(20px) saturate(200%);
            box-shadow: 0 12px 40px rgba(139, 127, 255, 0.2);
            border-color: var(--accent-primary);
        }

        /* Detail Sections */
        .detail-section {
            background: rgba(26, 31, 58, 0.4);
            backdrop-filter: blur(10px) saturate(180%);
            -webkit-backdrop-filter: blur(10px) saturate(180%);
            padding: 2rem;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.08);
            margin-bottom: 2rem;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
        }

        .detail-section h3 {
            color: var(--accent-primary);
            margin-top: 0;
            margin-bottom: 1.5rem;
            font-size: 1.5rem;
            font-weight: 600;
        }

        /* Foundation Badges */
        .foundation-badge {
            padding: 0.3rem 0.6rem;
            border-radius: 8px;
            font-size: 0.75rem;
            font-weight: 500;
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            display: inline-block;
        }

        .foundation-badge.established {
            background: rgba(81, 207, 102, 0.2);
            color: #51cf66;
            border: 1px solid rgba(81, 207, 102, 0.3);
        }

        .foundation-badge.derived {
            background: rgba(79, 172, 254, 0.2);
            color: #4dabf7;
            border: 1px solid rgba(79, 172, 254, 0.3);
        }

        .foundation-badge.pm-specific {
            background: rgba(139, 127, 255, 0.2);
            color: #8b7fff;
            border: 1px solid rgba(139, 127, 255, 0.3);
        }

        /* Section Navigation Grid */
        .section-nav {
            display: grid;
            gap: 1.5rem;
        }
    </style>
</head>
<body class="auth-loading">
    <div id="main-content" style="display: none;">
    <header>
        <div class="header-content">
            <div class="site-title" style="font-size: 1.5rem; font-weight: 700; color: var(--text-primary);">Principia Metaphysica</div>
            <nav>
                <ul>
                    <li><a href="../index.html">Home</a></li>
                    <li><a href="../sections/index.html">Sections</a></li>
                    <li><a href="../principia-metaphysica-paper.html">Full Paper</a></li>
                </ul>
            </nav>
        </div>
        <div class="user-controls">
            <img id="user-avatar" src="/images/default-avatar.svg" alt="User">
            <span id="user-email"></span>
            <button id="logout-btn">Logout</button>
        </div>
    </header>

    <main>
        <nav class="breadcrumb" aria-label="Breadcrumb">
            <a href="../index.html">Home</a>
            <span class="separator">/</span>
            <span>Foundational Physics</span>
        </nav>

        <div class="intro">
            <h2>Foundational Physics</h2>
            <p>
                Principia Metaphysica builds upon well-established physics. This section provides detailed explanations
                of the foundational equations from which the framework derives. Each formula can be traced back to
                experimentally verified physics.
            </p>
            <div style="display: flex; gap: 1rem; flex-wrap: wrap; margin-top: 1.5rem;">
                <span class="foundation-badge established">Established Physics</span>
                <span class="foundation-badge derived">Derived in PM</span>
                <span class="foundation-badge pm-specific">PM-Specific</span>
            </div>
        </div>

        <!-- Foundation Categories -->
        <section class="detail-section">
            <h3>General Relativity & Gravity</h3>
            <div class="section-nav" style="grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));">
                <a href="einstein-field-equations.html" class="section-card">
                    <span class="foundation-badge established">Established</span>
                    <h3 style="margin-top: 0.75rem;">Einstein Field Equations</h3>
                    <p>G<sub>&mu;&nu;</sub> + &Lambda;g<sub>&mu;&nu;</sub> = 8&pi;G T<sub>&mu;&nu;</sub></p>
                </a>
                <a href="einstein-hilbert-action.html" class="section-card">
                    <span class="foundation-badge established">Established</span>
                    <h3 style="margin-top: 0.75rem;">Einstein-Hilbert Action</h3>
                    <p>S = &int; d<sup>4</sup>x &radic;|g| R</p>
                </a>
                <a href="ricci-tensor.html" class="section-card">
                    <span class="foundation-badge established">Established</span>
                    <h3 style="margin-top: 0.75rem;">Ricci Tensor & Scalar</h3>
                    <p>R<sub>&mu;&nu;</sub>, R = g<sup>&mu;&nu;</sup>R<sub>&mu;&nu;</sub></p>
                </a>
                <a href="metric-tensor.html" class="section-card">
                    <span class="foundation-badge established">Established</span>
                    <h3 style="margin-top: 0.75rem;">Metric Tensor</h3>
                    <p>ds&sup2; = g<sub>&mu;&nu;</sub> dx<sup>&mu;</sup>dx<sup>&nu;</sup></p>
                </a>
            </div>
        </section>

        <section class="detail-section">
            <h3>Quantum Field Theory</h3>
            <div class="section-nav" style="grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));">
                <a href="dirac-equation.html" class="section-card">
                    <span class="foundation-badge established">Established</span>
                    <h3 style="margin-top: 0.75rem;">Dirac Equation</h3>
                    <p>(i&gamma;<sup>&mu;</sup>&part;<sub>&mu;</sub> - m)&psi; = 0</p>
                </a>
                <a href="dirac-equation.html" class="section-card">
                    <span class="foundation-badge established">Established</span>
                    <h3 style="margin-top: 0.75rem;">Dirac Lagrangian</h3>
                    <p>&Lscr; = <span style="text-decoration: overline;">&psi;</span>(i&gamma;<sup>&mu;</sup>&part;<sub>&mu;</sub> - m)&psi;</p>
                </a>
                <a href="clifford-algebra.html" class="section-card">
                    <span class="foundation-badge established">Established</span>
                    <h3 style="margin-top: 0.75rem;">Clifford Algebra</h3>
                    <p>{&gamma;<sup>&mu;</sup>, &gamma;<sup>&nu;</sup>} = 2g<sup>&mu;&nu;</sup></p>
                </a>
                <a href="yang-mills.html" class="section-card">
                    <span class="foundation-badge established">Established</span>
                    <h3 style="margin-top: 0.75rem;">Yang-Mills Theory</h3>
                    <p>&Lscr; = -&frac14;F<sub>&mu;&nu;</sub><sup>a</sup>F<sup>a&mu;&nu;</sup></p>
                </a>
                <a href="dirac-spinor.html" class="section-card">
                    <span class="foundation-badge established">Established</span>
                    <h3 style="margin-top: 0.75rem;">Dirac Spinors</h3>
                    <p>&psi; = (&psi;<sub>L</sub>, &psi;<sub>R</sub>)<sup>T</sup> &mdash; 4-component</p>
                </a>
            </div>
        </section>

        <section class="detail-section">
            <h3>Extra Dimensions & Unification</h3>
            <div class="section-nav" style="grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));">
                <a href="kaluza-klein.html" class="section-card">
                    <span class="foundation-badge established">Established</span>
                    <h3 style="margin-top: 0.75rem;">Kaluza-Klein Theory</h3>
                    <p>Dimensional reduction: <span class="pm-value" data-pm-value="dimensions.D_after_sp2r"></span>D &rarr; 6D &rarr; 4D</p>
                </a>
                <a href="g2-manifolds.html" class="section-card" style="border: 2px solid rgba(139, 127, 255, 0.4);">
                    <span class="foundation-badge established">Established</span>
                    <h3 style="margin-top: 0.75rem;">G&#8322; Manifolds</h3>
                    <p><span class="pm-value" data-pm-value="dimensions.D_G2"></span>D holonomy manifolds for M-theory</p>
                    <span class="foundation-badge pm-specific" style="margin-top: 0.5rem;">PM Internal Geometry</span>
                </a>
                <a href="calabi-yau.html" class="section-card">
                    <span class="foundation-badge established">Established</span>
                    <h3 style="margin-top: 0.75rem;">Calabi-Yau Manifolds</h3>
                    <p>Ricci-flat K&auml;hler manifolds (comparison)</p>
                </a>
                <a href="so10-gut.html" class="section-card">
                    <span class="foundation-badge established">Established</span>
                    <h3 style="margin-top: 0.75rem;">SO(10) Grand Unification</h3>
                    <p>16-dimensional spinor representation</p>
                </a>
            </div>
        </section>

        <section class="detail-section">
            <h3>Thermodynamics & Statistical Mechanics</h3>
            <div class="section-nav" style="grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));">
                <a href="boltzmann-entropy.html" class="section-card">
                    <span class="foundation-badge established">Established</span>
                    <h3 style="margin-top: 0.75rem;">Boltzmann Entropy</h3>
                    <p>S = k<sub>B</sub> ln &Omega;</p>
                </a>
                <a href="kms-condition.html" class="section-card">
                    <span class="foundation-badge established">Established</span>
                    <h3 style="margin-top: 0.75rem;">KMS Condition</h3>
                    <p>Thermal equilibrium states</p>
                </a>
                <a href="tomita-takesaki.html" class="section-card">
                    <span class="foundation-badge established">Established</span>
                    <h3 style="margin-top: 0.75rem;">Tomita-Takesaki Theory</h3>
                    <p>Modular automorphisms</p>
                </a>
                <a href="hawking-temperature.html" class="section-card">
                    <span class="foundation-badge established">Established</span>
                    <h3 style="margin-top: 0.75rem;">Hawking Temperature</h3>
                    <p>T<sub>H</sub> = &hbar;c&sup3;/(8&pi;GMk<sub>B</sub>)</p>
                </a>
                <a href="unruh-effect.html" class="section-card">
                    <span class="foundation-badge established">Established</span>
                    <h3 style="margin-top: 0.75rem;">Unruh Effect</h3>
                    <p>T = &hbar;a/(2&pi;ck<sub>B</sub>)</p>
                </a>
            </div>
        </section>

        <!-- PM-Derived Formulas Section - DYNAMIC -->
        <section class="detail-section" id="pm-formulas">
            <h3>PM-Derived Formulas</h3>
            <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">
                Unique formulas derived within the Principia Metaphysica framework - <strong id="formula-count-display">Loading...</strong> formulas organized by category
            </p>

            <!-- Category Filter Tabs -->
            <div class="formula-category-tabs" style="margin: 1.5rem 0; display: flex; gap: 0.75rem; flex-wrap: wrap;">
                <button class="category-tab active" data-category="THEORY" style="padding: 0.5rem 1rem; border-radius: 8px; background: rgba(255, 126, 182, 0.15); border: 2px solid rgba(255, 193, 7, 0.5); color: var(--text-primary); cursor: pointer; transition: all 0.3s ease; font-weight: 600;">PM Theory</button>
                <button class="category-tab" data-category="ALL_PM" style="padding: 0.5rem 1rem; border-radius: 8px; background: rgba(255, 126, 182, 0.08); border: 2px solid rgba(255, 193, 7, 0.3); color: var(--text-secondary); cursor: pointer; transition: all 0.3s ease; font-weight: 600;">All PM</button>
                <button class="category-tab" data-category="ALL" style="padding: 0.5rem 1rem; border-radius: 8px; background: rgba(139, 127, 255, 0.08); border: 1px solid rgba(139, 127, 255, 0.2); color: var(--text-secondary); cursor: pointer; transition: all 0.3s ease; font-weight: 500;">All Formulas</button>
                <button class="category-tab" data-category="ESTABLISHED" style="padding: 0.5rem 1rem; border-radius: 8px; background: rgba(100, 100, 100, 0.08); border: 1px solid rgba(100, 100, 100, 0.2); color: var(--text-muted); cursor: pointer; transition: all 0.3s ease; font-weight: 500;">Established</button>
                <button class="category-tab" data-category="DERIVED" style="padding: 0.5rem 1rem; border-radius: 8px; background: rgba(81, 207, 102, 0.08); border: 1px solid rgba(81, 207, 102, 0.2); color: var(--text-secondary); cursor: pointer; transition: all 0.3s ease; font-weight: 500;">Derived</button>
                <button class="category-tab" data-category="PREDICTIONS" style="padding: 0.5rem 1rem; border-radius: 8px; background: rgba(79, 172, 254, 0.08); border: 1px solid rgba(79, 172, 254, 0.2); color: var(--text-secondary); cursor: pointer; transition: all 0.3s ease; font-weight: 500;">Predictions</button>
            </div>

            <!-- Dynamically populated formula grid -->
            <div id="formula-panels-container" class="section-nav" style="grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));">
                <!-- Panels populated by JavaScript from formula-definitions.js -->
                <p style="grid-column: 1/-1; text-align: center; padding: 2rem; color: var(--text-muted);">Loading formulas...</p>
            </div>
        </section>

        <!-- Formula Details Modal -->
        <div id="formula-modal" class="modal" style="display: none; position: fixed; z-index: 10000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.7);">
            <div class="modal-content" style="background-color: var(--bg-card); margin: 5% auto; padding: 2rem; border: 1px solid var(--border-primary); border-radius: 16px; width: 80%; max-width: 900px; box-shadow: 0 8px 32px rgba(0,0,0,0.3);">
                <span class="modal-close" style="color: var(--text-muted); float: right; font-size: 2rem; font-weight: bold; cursor: pointer; transition: color 0.3s;">&times;</span>
                <div id="formula-modal-body" style="margin-top: 1rem;">
                    <!-- Dynamically populated -->
                </div>
            </div>
        </div>
    </main>

        <footer>
        <p>
            <strong>Principia Metaphysica</strong><br>
            &copy; 2025 Andrew Keith Watts. All rights reserved.
        </p>
        <p style="font-size: 0.85rem; color: var(--text-muted); margin-top: 0.5rem;">
            This project was developed with the assistance of AI tools including Claude (Anthropic),
            Grok (xAI), and Gemini (Google).
        </p>
    </footer>
    </div>

    <!-- Load formula database -->
    <script src="../js/formula-definitions.js"></script>

    <!-- Dynamic Formula Panel System -->
    <script>
        // State
        let currentCategory = 'THEORY';

        // Category color mapping
        const categoryColors = {
            'ESTABLISHED': { bg: 'rgba(139, 127, 255, 0.08)', border: 'rgba(139, 127, 255, 0.25)', badge: '#8b7fff' },
            'THEORY': { bg: 'rgba(255, 126, 182, 0.08)', border: 'rgba(255, 126, 182, 0.25)', badge: '#ff7eb6' },
            'DERIVED': { bg: 'rgba(81, 207, 102, 0.08)', border: 'rgba(81, 207, 102, 0.25)', badge: '#51cf66' },
            'PREDICTIONS': { bg: 'rgba(79, 172, 254, 0.08)', border: 'rgba(79, 172, 254, 0.25)', badge: '#4facfe' }
        };

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Display formula counts
            const counts = getFormulaCounts();
            const pmTotal = counts.THEORY + counts.DERIVED + counts.PREDICTIONS;
            document.getElementById('formula-count-display').innerHTML =
                `${counts.TOTAL} total (${pmTotal} PM-specific: ${counts.THEORY} theory, ${counts.DERIVED} derived, ${counts.PREDICTIONS} predictions | ${counts.ESTABLISHED} established)`;

            // Populate formulas - start with PM Theory (default)
            renderFormulas('THEORY');

            // Setup category tabs
            document.querySelectorAll('.category-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const category = this.dataset.category;

                    // Update active state
                    document.querySelectorAll('.category-tab').forEach(t => {
                        t.classList.remove('active');

                        // Reset styling based on category type
                        if (t.dataset.category === 'THEORY' || t.dataset.category === 'ALL_PM') {
                            // PM-specific buttons get gold border
                            t.style.background = t.dataset.category === 'THEORY' ? 'rgba(255, 126, 182, 0.08)' : 'rgba(255, 126, 182, 0.08)';
                            t.style.border = '2px solid rgba(255, 193, 7, 0.3)';
                            t.style.color = 'var(--text-secondary)';
                            t.style.fontWeight = '600';
                        } else if (t.dataset.category === 'ESTABLISHED') {
                            // Established gets grey/de-emphasized
                            t.style.background = 'rgba(100, 100, 100, 0.08)';
                            t.style.border = '1px solid rgba(100, 100, 100, 0.2)';
                            t.style.color = 'var(--text-muted)';
                            t.style.fontWeight = '500';
                        } else if (t.dataset.category === 'ALL') {
                            t.style.background = 'rgba(139, 127, 255, 0.08)';
                            t.style.border = '1px solid rgba(139, 127, 255, 0.2)';
                            t.style.color = 'var(--text-secondary)';
                            t.style.fontWeight = '500';
                        } else {
                            // DERIVED, PREDICTIONS
                            t.style.background = categoryColors[t.dataset.category]?.bg || 'rgba(139, 127, 255, 0.08)';
                            t.style.border = '1px solid ' + (categoryColors[t.dataset.category]?.border || 'rgba(139, 127, 255, 0.2)');
                            t.style.color = 'var(--text-secondary)';
                            t.style.fontWeight = '500';
                        }
                    });

                    // Apply active styling to clicked tab
                    this.classList.add('active');
                    if (category === 'THEORY' || category === 'ALL_PM') {
                        this.style.background = 'rgba(255, 126, 182, 0.15)';
                        this.style.border = '2px solid rgba(255, 193, 7, 0.5)';
                        this.style.color = 'var(--text-primary)';
                    } else if (category === 'ESTABLISHED') {
                        this.style.background = 'rgba(100, 100, 100, 0.15)';
                        this.style.border = '1px solid rgba(100, 100, 100, 0.4)';
                        this.style.color = 'var(--text-primary)';
                    } else if (category === 'ALL') {
                        this.style.background = 'rgba(139, 127, 255, 0.15)';
                        this.style.border = '1px solid rgba(139, 127, 255, 0.3)';
                        this.style.color = 'var(--text-primary)';
                    } else {
                        this.style.background = categoryColors[category]?.bg.replace('0.08', '0.15') || 'rgba(139, 127, 255, 0.15)';
                        this.style.border = '1px solid ' + (categoryColors[category]?.border || 'rgba(139, 127, 255, 0.3)');
                        this.style.color = 'var(--text-primary)';
                    }

                    // Render formulas for selected category
                    currentCategory = category;
                    renderFormulas(category);
                });
            });

            // Setup modal close
            document.querySelector('.modal-close').addEventListener('click', closeModal);
            window.addEventListener('click', function(event) {
                const modal = document.getElementById('formula-modal');
                if (event.target === modal) {
                    closeModal();
                }
            });
        });

        function renderFormulas(category) {
            const container = document.getElementById('formula-panels-container');
            container.innerHTML = '';

            let formulas = [];

            if (category === 'ALL') {
                // Get all formulas from all categories
                for (const cat of ['ESTABLISHED', 'THEORY', 'DERIVED', 'PREDICTIONS']) {
                    const catFormulas = Object.entries(PM_FORMULAS[cat] || {}).map(([key, formula]) => ({
                        ...formula,
                        key,
                        category: cat
                    }));
                    formulas = formulas.concat(catFormulas);
                }
            } else if (category === 'ALL_PM') {
                // Get all PM-specific formulas (Theory + Derived + Predictions)
                for (const cat of ['THEORY', 'DERIVED', 'PREDICTIONS']) {
                    const catFormulas = Object.entries(PM_FORMULAS[cat] || {}).map(([key, formula]) => ({
                        ...formula,
                        key,
                        category: cat
                    }));
                    formulas = formulas.concat(catFormulas);
                }
            } else {
                // Get formulas from specific category
                formulas = Object.entries(PM_FORMULAS[category] || {}).map(([key, formula]) => ({
                    ...formula,
                    key,
                    category
                }));
            }

            if (formulas.length === 0) {
                container.innerHTML = '<p style="grid-column: 1/-1; text-align: center; padding: 2rem; color: var(--text-muted);">No formulas found in this category.</p>';
                return;
            }

            // Create formula cards
            formulas.forEach(formula => {
                const card = createFormulaCard(formula);
                container.appendChild(card);
            });
        }

        function createFormulaCard(formula) {
            const colors = categoryColors[formula.category];

            const card = document.createElement('div');
            card.className = 'section-card';
            card.style.background = colors.bg;
            card.style.border = `1px solid ${colors.border}`;
            card.style.cursor = 'pointer';
            card.style.transition = 'all 0.3s ease';

            card.innerHTML = `
                <span class="foundation-badge" style="background: ${colors.bg.replace('0.08', '0.2')}; color: ${colors.badge}; border: 1px solid ${colors.border};">
                    ${formula.category}
                </span>
                <h3 style="margin-top: 0.75rem; font-size: 1.1rem; color: var(--text-primary);">
                    ${formula.label || formula.id}
                </h3>
                <div style="font-family: 'Crimson Text', serif; font-size: 1rem; margin: 0.75rem 0; padding: 0.75rem; background: ${colors.bg.replace('0.08', '0.05')}; border-radius: 8px; color: var(--text-primary);">
                    ${formula.html}
                </div>
                <p style="font-size: 0.9rem; color: var(--text-secondary); margin: 0.5rem 0;">
                    ${formula.description.substring(0, 120)}${formula.description.length > 120 ? '...' : ''}
                </p>
                ${formula.v12_7_status ? `<p style="font-size: 0.8rem; color: ${colors.badge}; margin-top: 0.5rem; font-weight: 500;">v12.7: ${formula.v12_7_status}</p>` : ''}
            `;

            card.addEventListener('click', () => showFormulaDetails(formula));
            card.addEventListener('mouseenter', function() {
                this.style.transform = 'translateY(-4px)';
                this.style.boxShadow = `0 8px 24px ${colors.border}`;
            });
            card.addEventListener('mouseleave', function() {
                this.style.transform = 'translateY(0)';
                this.style.boxShadow = 'none';
            });

            return card;
        }

        function showFormulaDetails(formula) {
            const modal = document.getElementById('formula-modal');
            const body = document.getElementById('formula-modal-body');
            const colors = categoryColors[formula.category];

            let html = `
                <div style="margin-bottom: 1.5rem;">
                    <span class="foundation-badge" style="background: ${colors.bg.replace('0.08', '0.2')}; color: ${colors.badge}; border: 1px solid ${colors.border};">
                        ${formula.category}
                    </span>
                    <h2 style="margin-top: 0.75rem; color: var(--text-primary);">${formula.label || formula.id}</h2>
                    ${formula.attribution ? `<p style="color: var(--text-muted); font-size: 0.9rem;">${formula.attribution}</p>` : ''}
                </div>

                <div style="background: ${colors.bg}; border: 1px solid ${colors.border}; border-radius: 12px; padding: 1.5rem; margin: 1.5rem 0;">
                    <div style="font-family: 'Crimson Text', serif; font-size: 1.4rem; text-align: center; color: var(--text-primary);">
                        ${formula.html}
                    </div>
                    ${formula.latex ? `<p style="margin-top: 0.75rem; text-align: center; font-family: monospace; font-size: 0.8rem; color: var(--text-muted);">LaTeX: ${formula.latex}</p>` : ''}
                </div>

                <div style="margin: 1.5rem 0;">
                    <h3 style="color: var(--accent-primary); margin-bottom: 0.75rem;">Description</h3>
                    <p style="color: var(--text-secondary); line-height: 1.8;">${formula.description}</p>
                </div>
            `;

            // Add terms/variables
            if (formula.terms && Object.keys(formula.terms).length > 0) {
                html += `
                    <div style="margin: 1.5rem 0;">
                        <h3 style="color: var(--accent-primary); margin-bottom: 0.75rem;">Terms & Variables</h3>
                        <div style="display: grid; gap: 0.75rem;">
                `;

                for (const [symbol, info] of Object.entries(formula.terms)) {
                    const termInfo = typeof info === 'object' ? info : { name: info, description: '' };
                    html += `
                        <div style="padding: 0.75rem; background: var(--bg-secondary); border-radius: 8px; border: 1px solid var(--border-primary);">
                            <strong style="color: var(--accent-primary); font-family: 'Crimson Text', serif;">${symbol}</strong>
                            ${termInfo.name ? `<span style="color: var(--text-primary);"> — ${termInfo.name}</span>` : ''}
                            ${termInfo.description ? `<p style="margin: 0.25rem 0 0 0; color: var(--text-secondary); font-size: 0.9rem;">${termInfo.description}</p>` : ''}
                        </div>
                    `;
                }

                html += `</div></div>`;
            }

            // Add derivation if present
            if (formula.derivation) {
                html += `
                    <div style="margin: 1.5rem 0;">
                        <h3 style="color: var(--accent-primary); margin-bottom: 0.75rem;">Derivation</h3>
                        <p style="color: var(--text-secondary); line-height: 1.8;">${formula.derivation}</p>
                    </div>
                `;
            }

            // Add experimental comparison if present
            if (formula.experimental_value !== undefined) {
                html += `
                    <div style="margin: 1.5rem 0; padding: 1rem; background: rgba(79, 172, 254, 0.08); border: 1px solid rgba(79, 172, 254, 0.25); border-radius: 8px;">
                        <h3 style="color: #4facfe; margin-bottom: 0.75rem;">Experimental Comparison</h3>
                        <p style="color: var(--text-secondary);">
                            <strong>Experimental value:</strong> ${formula.experimental_value}
                            ${formula.experimental_source ? ` (${formula.experimental_source})` : ''}
                        </p>
                        ${formula.sigma !== undefined ? `<p style="color: var(--text-secondary); margin-top: 0.5rem;"><strong>Agreement:</strong> ${formula.sigma}σ</p>` : ''}
                        ${formula.currentData ? `<p style="color: var(--text-secondary); margin-top: 0.5rem;"><strong>Current data:</strong> ${formula.currentData}</p>` : ''}
                    </div>
                `;
            }

            // Add testability info if present
            if (formula.testBy) {
                html += `
                    <div style="margin: 1.5rem 0; padding: 1rem; background: rgba(255, 193, 7, 0.08); border: 1px solid rgba(255, 193, 7, 0.25); border-radius: 8px;">
                        <h3 style="color: #ffc107; margin-bottom: 0.75rem;">Testability</h3>
                        <p style="color: var(--text-secondary);"><strong>Test by:</strong> ${formula.testBy}</p>
                        ${formula.falsification ? `<p style="color: var(--text-secondary); margin-top: 0.5rem;"><strong>Falsification:</strong> ${formula.falsification}</p>` : ''}
                    </div>
                `;
            }

            // Add v12.7 status
            if (formula.v12_7_status) {
                html += `
                    <div style="margin: 1.5rem 0; padding: 1rem; background: rgba(81, 207, 102, 0.08); border: 1px solid rgba(81, 207, 102, 0.25); border-radius: 8px;">
                        <h3 style="color: #51cf66; margin-bottom: 0.75rem;">v12.7 Framework Status</h3>
                        <p style="color: var(--text-secondary);">${formula.v12_7_status}</p>
                    </div>
                `;
            }

            body.innerHTML = html;
            modal.style.display = 'block';
        }

        function closeModal() {
            document.getElementById('formula-modal').style.display = 'none';
        }
    </script>

    <script type="module">
        import { setupAuthGuard } from '/js/auth-guard.js';
        setupAuthGuard('foundations-index');
    </script>
</body>
</html>
