/**
 * theory-constants.js - Principia Metaphysica Theory Constants
 *
 * v16.2 DYNAMIC BRIDGE - Loads values from parameters.json via PMTheoryBridge
 *
 * Static fallback values are provided for when the bridge is not loaded.
 * The PMTheoryBridge.load() call will update these with derived values.
 *
 * Generated: 2026-01-01
 * Framework Version: v16.2
 * Source of Truth: AutoGenerated/parameters.json
 *
 * To regenerate after editing simulations:
 *   python run_all_simulations.py
 */

const TheoryConstants = {

    // ================================================================
    // DIMENSIONAL STRUCTURE (from GeometricAnchors.D_bulk, D_G2, etc.)
    // ================================================================

    dimensions: {
        full: 26,                    // D_bulk: Full theory dimensionality
        signature: { space: 24, time: 2 },   // (24,2) signature from Cl(24,2)
        effective: 7,                // D_G2: G2 holonomy manifold
        effectiveSignature: { space: 12, time: 1 },  // (12,1) after Sp(2,R)
        observable: 4,               // Macroscopic spacetime

        // Brane hierarchy
        nBranes: 4,                  // Number of D-branes
        spatialDimsPerBrane: 3,      // Spatial dimensions per brane
        timeDims: 1,                 // Shared time dimension

        // Derived
        get dEff() { return 12; },   // D_shadow: Effective spatial dimensions
        get totalCheck() { return this.nBranes * this.spatialDimsPerBrane + this.timeDims; }
    },

    // ================================================================
    // SPINOR STRUCTURE (from GeometricAnchors)
    // ================================================================

    spinors: {
        full26D: 8192,       // spinor_26d: 2^13 components in Cl(24,2)
        effective13D: 64,    // spinor_13d: 2^6 after Sp(2,R) gauge fixing

        // Clifford algebras
        clifford26D: "Cl(24,2)",
        clifford13D: "Cl(12,1)",
        clifford4D: "Cl(3,1)",

        get reductionRatio() { return this.full26D / this.effective13D; }  // 128
    },

    // ================================================================
    // TOPOLOGY & GENERATIONS (from GeometricAnchors.b3=24)
    // ================================================================

    topology: {
        // TCS #187 Hodge numbers
        h11: 4,              // geometry.h11
        h21: 0,              // geometry.h21
        h31: 68,             // geometry.h31

        // Euler characteristic
        chiEffective: 144,   // geometry.chi_eff: 2(h11 - h21 + h31) = 144

        // Flux quantization
        fluxReduction: 2,    // geometry.flux_reduction

        // Generations: chi_eff / 48 = 3
        generations: 3,      // geometry.n_generations

        // SO(10) representations
        adjointDim: 45,
        spinorDim: 16,
    },

    // ================================================================
    // FUNDAMENTAL SCALES
    // ================================================================

    fundamentalScales: {
        mPlanck: 1.220819e+19,       // GeV (CODATA 2022 FULL Planck mass)
        mStar: 2.435183e+18,            // geometry.M_star: M_Pl/sqrt(8pi)
        mGUT: 2.100000e+16,               // geometry.M_GUT_geometric
        alphaGUT: 0.0411523,            // geometry.alpha_gut: 1/24.3
        alphaEM: 0.00729735,         // geometry.alpha_inverse^-1
    },

    // ================================================================
    // DARK ENERGY (v16.2 DESI 2025 Thawing Quintessence)
    // ================================================================

    darkEnergy: {
        // v16.2 Theoretical values (from G2 topology b3=24)
        w0Numerator: -23,
        w0Denominator: 24,
        w0: -0.958333,                 // geometry.w_zero: -1 + 1/b3 = -23/24
        wa: -0.816497,                  // geometry.wa: -1/sqrt(b3)

        // Observational values (DESI 2025 Thawing)
        w0Observed: -0.957,          // geometry.w0_observed_DESI
        w0Error: 0.067,              // geometry.w0_error_DESI
        waObserved: -0.99,           // geometry.wa_observed_DESI
        waError: 0.35,

        // Cosmological parameters
        omegaLambda: 0.7,          // geometry.Omega_Lambda
        omegaMatter: 0.315,          // geometry.Omega_matter
        omegaBaryon: 0.198347,         // geometry.Omega_baryon
        H0: 67.4,                    // geometry.H0_early (km/s/Mpc)
    },

    // ================================================================
    // THERMAL TIME HYPOTHESIS
    // ================================================================

    thermalTime: {
        alphaT: 3.36514,                // geometry.alpha_T: 2pi*k_gimel/(b3-1)
        alphaTBase: 2.7,             // geometry.alpha_T_phenomenological
        z2Correction: 0.2,

        // Epoch-dependent values
        alphaTz0: 1.67,
        alphaTz1: 2.38,
        alphaTz2: 2.59,
        alphaTHighZ: 2.7,

        get waFormula() { return `w_a = -1/sqrt(b3) = -1/sqrt(24) = -0.204`; }
    },

    // ================================================================
    // F(R,T,tau) MODIFIED GRAVITY
    // ================================================================

    modifiedGravity: {
        alphaRSquared: 0.0045,       // geometry.alpha_R_squared_phenom
        betaMatter: 0.15,
        gammaMixed: 0.0001,
        deltaOrthoTime: 1e-19,

        phi0Breathing: 0.00674181,       // geometry.xi_breathing
        nEffPneuma: 64,              // geometry.pneuma_components (v16.2)
    },

    // ================================================================
    // MULTI-TIME STRUCTURE (v16.2: deprecated xi/eta replaced by pneuma_components)
    // ================================================================

    multiTime: {
        // Coupling constants
        g: 0.1,
        eFermi: 1.0,

        // v16.2: Legacy xi/eta replaced by geometry.pneuma_components (64)
        xi: 64,                      // Was 10^10, now pneuma_components
        eta: 0.1,
        etaBoosted: 64,              // Was 10^9, now pneuma_components

        // Orthogonal time parameters
        deltaTOrtho: 1e-18,
        rOrtho: 1.0,

        // LISA frequencies
        kLISAMin: 0.0001,
        kLISATypical: 0.001,         // geometry.k_LISA_typical
        kLISAMax: 0.1,

        // Mirror sector
        thetaMirror: 0.0,
        theta45Deg: 0.785398,          // geometry.theta_45deg (pi/4)
    },

    // ================================================================
    // MODULI STABILIZATION (v16.2: F-term from pneuma_components)
    // ================================================================

    moduli: {
        // SUSY breaking
        fTerm: 1.0,
        fTermPhysical: 64,           // v16.2: Was 10^10, now pneuma_components

        // Swampland parameters
        aSwampland: 1.32112,            // geometry.a_swampland: sqrt(2/3)*phi
        swamplandBound: 0.816,       // sqrt(2/3)

        // Potential terms
        kappaUplift: 1.0,
        bInstanton: 1.0,
        muPeriodic: 0.5,

        // Condensate
        lambdaCoupling: 0.5,
        vVEV: 2.0,
        tOrthoNorm: 1.0,

        condensateGap: 0.909,
    },

    // ================================================================
    // LANDSCAPE & MULTIVERSE
    // ================================================================

    landscape: {
        // Vacuum counting
        nVacExponent: 500,
        landscapeEntropy: 1314.83,      // geometry.landscape_entropy

        // Coleman-De Luccia tunneling
        sigmaTension: 1.0,
        deltaVMultiverse: 64,        // v16.2: Was 10^10, now pneuma_components

        // CMB bubble collisions
        bubbleRadiusMpc: 100,
        cmbTemperatureUK: 100,

        get euclideanAction() { return 1.33e-28; },
        get tunnelingRate() { return 1.0; },
    },

    // ================================================================
    // v16.2 PREDICTIONS (Testable!)
    // ================================================================

    v128Predictions: {
        // Kaluza-Klein modes (LHC-testable)
        mKKCentral: 5,             // geometry.m_KK_central (TeV)
        mKKMin: 3.0,
        mKKMax: 7.0,
        mKKCurrentBound: 3.5,        // geometry.m_KK_bound (TeV)

        // GW dispersion (LISA-testable)
        etaBaseline: 0.1,
        etaBoosted: 64,              // v16.2: pneuma_components
        etaEffectMin: 1e-29,
        etaEffectMax: 1e-20,

        // SME Lorentz violation (Collider-testable)
        cMuNuFermion: 1e-5,
        cEMuRatio: 2e-5,
        sMuNuGW: 1e-15,

        // Quantum nonlocality (Lab-testable)
        chshDeltaOrtho: 1e-5,
        chshPredicted: 2.828028,
        chshStatisticsRequired: 1e11,

        // Mirror sector (CMB-testable)
        deltaNEffMin: 0.08,
        deltaNEffMax: 0.16,
        deltaNEffCentral: 0.12,
    },

    // ================================================================
    // NEUTRINO SECTOR (v16.2 Hopf Fibration Fix)
    // ================================================================

    neutrinos: {
        // Normal Hierarchy (from G2 topology)
        hierarchy: "Normal",

        // Mass spectrum (v16.2 Hopf Fibration)
        mNu1: 0.001,
        mNu2: 0.009,
        mNu3: 0.05,
        sumMNu: 0.0816883,               // geometry.sum_m_nu: k_gimel/(2pi*b3)

        // Oscillation parameters
        deltaMSq21: 7.420000e-5,         // geometry.dm21_squared (eV^2)
        deltaMSq31: 0.00251,         // geometry.dm31_squared (eV^2)

        // Mixing angles (PMNS from octonionic triality)
        theta_12: 33.41,             // geometry.theta_12 (degrees)
        theta_13: 8.54,              // geometry.theta_13 (degrees)
        theta_23: 49,              // geometry.theta_23 (degrees)
        delta_CP: 278.4,             // geometry.delta_CP_PMNS (degrees)

        // Seesaw scale
        mRHNeutrino: 1e14,
    },

    // ================================================================
    // CKM MATRIX (Octonionic Triality)
    // ================================================================

    ckmMatrix: {
        V_us: 0.224304,                 // geometry.V_us (Cabibbo angle)
        V_cb: 0.040753,                 // geometry.V_cb
        V_ub: 0.00372414,                // geometry.V_ub
        jarlskogInvariant: 3.000000e-5,   // geometry.J_CKM
        wolfensteinA: 0.81,          // geometry.A_Wolfenstein
        wolfensteinLambda: 0.224304,    // geometry.lambda_Wolfenstein
    },

    // ================================================================
    // CMB BUBBLE COLLISIONS
    // ================================================================

    cmbBubbles: {
        sigmaCMBRMS: 0.003,
        thetaSpotDeg: 1.0,
        thetaSpotRad: 0.017,
        nMinimaDensity: 1650,
        skyAreaSR: 12.566,

        delta3Sigma: 0.009,
        delta5Sigma: 0.015,

        deltaDiskCollision: 0.1,
        fNLBubble: 100,

        lambdaThreshold: 0.001,

        kurtosisExcess: (nDisk, delta, sigma) => {
            return 3 + nDisk * Math.pow(delta/sigma, 4);
        }
    },

    // ================================================================
    // PROTON DECAY
    // ================================================================

    protonDecay: {
        tauProton: 1.000000e+36,             // geometry.tau_proton (years)
        tauLowerBound: 1.67e34,      // Super-K bound

        branchingRatio: (theta) => {
            const beta = Math.cos(theta);
            return 1 / (1 + beta * beta);
        }
    },

    // ================================================================
    // COMPUTATIONAL SETTINGS
    // ================================================================

    computational: {
        nQutipToy: 4,
        nQutipProduction: 10,

        timeStart: 0,
        timeEnd: 10,
        timeSteps: 100,

        toleranceUnitarity: 1e-10,
        toleranceConvergence: 1e-8,

        aLimitExponent: 10,

        sympyPrecision: 10,
    },

    // ================================================================
    // METADATA
    // ================================================================

    metadata: {
        version: "16.2",
        lastGenerated: "2026-01-01",
        generatedFrom: "AutoGenerated/parameters.json via generate_js_constants.py",
        frameworkName: "Principia Metaphysica",
        sourceOfTruth: "AutoGenerated/parameters.json",

        // Dynamic loading status
        dynamicLoaded: false,

        // Validation checks
        validate: function() {
            const checks = {
                swampland: this.parent.moduli.aSwampland > this.parent.moduli.swamplandBound,
                generations: this.parent.topology.generations === 3,
                dimensions: this.parent.dimensions.totalCheck === 13,
                w0Geometric: Math.abs(this.parent.darkEnergy.w0 - (-23/24)) < 0.001
            };

            const allPass = Object.values(checks).every(v => v === true);
            return { checks, allPass };
        }
    },

    // ================================================================
    // DYNAMIC BRIDGE INTEGRATION
    // ================================================================

    /**
     * Update constants from PMTheoryBridge when available.
     * Call this after PMTheoryBridge.load() completes.
     */
    updateFromBridge: async function() {
        if (typeof window === 'undefined' || !window.PMTheoryBridge) {
            console.warn('[TheoryConstants] PMTheoryBridge not available');
            return false;
        }

        try {
            await window.PMTheoryBridge.load();

            // Update key values from theory
            const bridge = window.PMTheoryBridge;

            // Dark Energy
            const w0 = bridge.resolve('geometry.w_zero');
            if (w0 !== null) this.darkEnergy.w0 = w0;

            const wa = bridge.resolve('geometry.wa');
            if (wa !== null) this.darkEnergy.wa = wa;

            // Neutrinos
            const sumMNu = bridge.resolve('geometry.sum_m_nu');
            if (sumMNu !== null) this.neutrinos.sumMNu = sumMNu;

            // Fundamental constants
            const alphaInv = bridge.resolve('geometry.alpha_inverse');
            if (alphaInv !== null) this.fundamentalScales.alphaEM = 1 / alphaInv;

            // Kaluza-Klein
            const mKK = bridge.resolve('geometry.m_KK_central');
            if (mKK !== null) this.v128Predictions.mKKCentral = mKK;

            // Mark as dynamically loaded
            this.metadata.dynamicLoaded = true;

            console.log('[TheoryConstants] Updated from PMTheoryBridge');
            return true;

        } catch (error) {
            console.error('[TheoryConstants] Failed to update from bridge:', error);
            return false;
        }
    }
};

// Add parent reference for metadata validation
TheoryConstants.metadata.parent = TheoryConstants;

// Export for use in other JS files
if (typeof module !== 'undefined' && module.exports) {
    module.exports = TheoryConstants;
}

// Auto-update from bridge when available
if (typeof window !== 'undefined') {
    // Wait for DOM and then try to update from bridge
    const tryUpdateFromBridge = async () => {
        if (window.PMTheoryBridge) {
            await TheoryConstants.updateFromBridge();
        } else {
            // Wait a bit for PMTheoryBridge to load
            setTimeout(async () => {
                if (window.PMTheoryBridge) {
                    await TheoryConstants.updateFromBridge();
                }
            }, 100);
        }
    };

    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', tryUpdateFromBridge);
    } else {
        tryUpdateFromBridge();
    }
}

// Display configuration summary
console.log('SUCCESS: Principia Metaphysica Theory Constants v16.2 loaded');
console.log(`  Framework: v${TheoryConstants.metadata.version}`);
console.log(`  Generated: ${TheoryConstants.metadata.lastGenerated}`);
console.log(`  Source: ${TheoryConstants.metadata.sourceOfTruth}`);
console.log(`  Dark Energy: w0 = ${TheoryConstants.darkEnergy.w0} (DESI 2025: ${TheoryConstants.darkEnergy.w0Observed})`);
console.log(`  Neutrinos: sum_m_nu = ${TheoryConstants.neutrinos.sumMNu} eV (Hopf Fibration)`);
console.log(`  Swampland: a = ${TheoryConstants.moduli.aSwampland.toFixed(3)} > ${TheoryConstants.moduli.swamplandBound.toFixed(3)} PASS`);
