#!/usr/bin/env python3
"""
Show key experimental comparisons from theory_output.json
"""

import json
from pathlib import Path

# Load data
theory_path = Path(__file__).parent / "AutoGenerated" / "theory_output.json"
with open(theory_path, 'r', encoding='utf-8') as f:
    data = json.load(f)

parameters = data['parameters']

# Define key parameters to showcase
key_params = [
    # Particle masses
    ("pdg.m_higgs", "Higgs mass"),
    ("pdg.m_top", "Top quark mass"),

    # Neutrino mixing
    ("nufit.theta_12", "Solar mixing angle"),
    ("nufit.theta_23", "Atmospheric mixing angle"),
    ("nufit.theta_13", "Reactor mixing angle"),
    ("nufit.delta_CP", "CP phase"),

    # Dark energy
    ("desi.w0", "Dark energy w0"),
    ("desi.wa", "Dark energy wa"),
    ("desi.H0", "Hubble constant"),

    # Cosmology
    ("planck.S8", "S8 parameter"),

    # Gauge couplings
    ("pdg.alpha_s_MZ", "Strong coupling"),
    ("pdg.sin2_theta_W", "Weak mixing angle"),
]

print("=" * 100)
print("KEY EXPERIMENTAL COMPARISONS - Principia Metaphysica vs Experiment")
print("=" * 100)
print()

for param_key, description in key_params:
    if param_key not in parameters:
        continue

    param = parameters[param_key]

    if 'experimentalValue' not in param:
        continue

    computed = param['value']
    comp_unc = param.get('uncertainty', 0)
    exp_value = param['experimentalValue']
    exp_unc = param['experimentalUncertainty']
    source = param['experimentalSource']
    units = param.get('metadata', {}).get('units', '')

    # Format values
    if abs(computed) > 1000 or abs(computed) < 0.01:
        comp_str = f"{computed:.4e}"
        exp_str = f"{exp_value:.4e}"
    else:
        comp_str = f"{computed:.4f}"
        exp_str = f"{exp_value:.4f}"

    # Get deviation
    if 'sigmaDeviation' in param:
        sigma = param['sigmaDeviation']
        deviation_str = f"{sigma:.2f}sig"

        # Status
        if sigma < 1.0:
            status = "EXCELLENT"
        elif sigma < 3.0:
            status = "GOOD"
        else:
            status = "NEEDS REVIEW"
    else:
        deviation_str = "N/A"
        status = "NO COMPARISON"

    print(f"{description:30s} [{units}]")
    print(f"  Computed:      {comp_str:15s} ± {comp_unc:.4g}")
    print(f"  Experimental:  {exp_str:15s} ± {exp_unc:.4g}")
    print(f"  Deviation:     {deviation_str:15s} ({status})")
    print(f"  Source:        {source}")
    print()

# Summary statistics
print("=" * 100)
print("SUMMARY STATISTICS")
print("=" * 100)

total_with_exp = sum(1 for p in parameters.values() if 'experimentalValue' in p)
excellent = sum(1 for p in parameters.values() if p.get('sigmaDeviation', 999) < 1.0)
good = sum(1 for p in parameters.values() if 1.0 <= p.get('sigmaDeviation', 999) < 3.0)
poor = sum(1 for p in parameters.values() if p.get('sigmaDeviation', 999) >= 3.0)

print(f"Total parameters with experimental values: {total_with_exp}")
print(f"  Excellent agreement (< 1sig):  {excellent:3d} ({100*excellent/total_with_exp:.1f}%)")
print(f"  Good agreement (1-3sig):       {good:3d} ({100*good/total_with_exp:.1f}%)")
print(f"  Poor agreement (> 3sig):       {poor:3d} ({100*poor/total_with_exp:.1f}%)")
print()
print("Overall agreement rate (excellent + good): {:.1f}%".format(100*(excellent+good)/total_with_exp))
print("=" * 100)
