<!DOCTYPE html>
<!--
    Copyright (c) 2025 Andrew Keith Watts. All rights reserved.

    This is the intellectual property of Andrew Keith Watts. Unauthorized
    reproduction, distribution, or modification of this code, in whole or in part,
    without the express written permission of Andrew Keith Watts is strictly prohibited.

    For inquiries, please contact AndrewKWatts@Gmail.com
-->

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Principia Metaphysica Simulation Code - Python implementations of the theoretical framework">
    <title>Simulations - Principia Metaphysica</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/auth.css">

    <!-- Prism.js for syntax highlighting -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.css" rel="stylesheet">

    <style>
        /* Simulation Page Specific Styles */
        .sim-hero {
            background: linear-gradient(135deg, rgba(81, 207, 102, 0.12), rgba(139, 127, 255, 0.08));
            border: 1px solid rgba(81, 207, 102, 0.25);
            border-radius: 20px;
            padding: 3rem;
            margin-bottom: 2.5rem;
            position: relative;
            overflow: hidden;
        }

        .sim-hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, #51cf66, #8b7fff);
        }

        .sim-hero h1 {
            font-size: 2.5rem;
            background: linear-gradient(135deg, #51cf66, #8b7fff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 1rem;
        }

        .sim-hero .lead {
            font-size: 1.15rem;
            color: var(--text-secondary);
            line-height: 1.8;
            max-width: 900px;
        }

        /* Index Section */
        .sim-index {
            background: var(--bg-card);
            border: 1px solid var(--border-primary);
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2.5rem;
        }

        .sim-index h2 {
            background: linear-gradient(135deg, #51cf66, #8b7fff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 1.5rem;
            font-size: 1.5rem;
        }

        .index-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1rem;
        }

        .index-category {
            background: rgba(139, 127, 255, 0.05);
            border: 1px solid var(--border-primary);
            border-radius: 12px;
            padding: 1.25rem;
        }

        .index-category h3 {
            color: var(--accent-primary);
            font-size: 1rem;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .index-category ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .index-category li {
            margin: 0.5rem 0;
        }

        .index-link {
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.35rem 0;
            transition: color 0.2s ease;
            cursor: pointer;
        }

        .index-link:hover {
            color: var(--accent-primary);
        }

        .index-link::before {
            content: '>';
            color: #51cf66;
            font-weight: bold;
        }

        /* File Section */
        .file-section {
            background: var(--bg-card);
            border: 1px solid var(--border-primary);
            border-radius: 16px;
            margin-bottom: 1.5rem;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .file-section:hover {
            border-color: var(--border-accent);
        }

        .file-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1.25rem 1.5rem;
            background: rgba(139, 127, 255, 0.05);
            cursor: pointer;
            user-select: none;
            transition: background 0.2s ease;
        }

        .file-header:hover {
            background: rgba(139, 127, 255, 0.1);
        }

        .file-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .file-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #51cf66, #40c057);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
        }

        .file-icon.json {
            background: linear-gradient(135deg, #ffc107, #ff9800);
        }

        .file-icon.js {
            background: linear-gradient(135deg, #f0db4f, #e6c200);
        }

        .file-name {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 1.1rem;
        }

        .file-path {
            font-size: 0.85rem;
            color: var(--text-muted);
            font-family: 'Fira Code', monospace;
        }

        .expand-icon {
            font-size: 1.5rem;
            color: var(--text-muted);
            transition: transform 0.3s ease;
        }

        .file-section.expanded .expand-icon {
            transform: rotate(180deg);
        }

        .file-content {
            display: none;
            border-top: 1px solid var(--border-primary);
        }

        .file-section.expanded .file-content {
            display: block;
        }

        .file-loading {
            padding: 2rem;
            text-align: center;
            color: var(--text-muted);
        }

        .file-loading .spinner {
            display: inline-block;
            width: 24px;
            height: 24px;
            border: 3px solid rgba(139, 127, 255, 0.2);
            border-top-color: var(--accent-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 0.75rem;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .file-error {
            padding: 1.5rem;
            background: rgba(255, 107, 107, 0.1);
            color: #ff6b6b;
            border-radius: 8px;
            margin: 1rem;
        }

        /* Code Display */
        .code-wrapper {
            max-height: 600px;
            overflow: auto;
            background: #1e1e1e;
        }

        .code-wrapper pre {
            margin: 0;
            padding: 1.5rem;
            font-size: 0.85rem;
            line-height: 1.6;
        }

        .code-wrapper code {
            font-family: 'Fira Code', 'Monaco', 'Consolas', monospace;
        }

        /* Stats Bar */
        .file-stats {
            display: flex;
            gap: 1.5rem;
            padding: 0.75rem 1.5rem;
            background: rgba(0, 0, 0, 0.2);
            font-size: 0.8rem;
            color: var(--text-muted);
            border-top: 1px solid var(--border-primary);
        }

        .file-stats span {
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }

        /* Category Headers */
        .category-header {
            background: linear-gradient(135deg, rgba(139, 127, 255, 0.1), rgba(81, 207, 102, 0.05));
            padding: 1.5rem;
            border-radius: 12px;
            margin: 2.5rem 0 1.5rem;
            border-left: 4px solid #51cf66;
        }

        .category-header h2 {
            color: var(--text-primary);
            margin: 0 0 0.5rem;
            font-size: 1.4rem;
        }

        .category-header p {
            color: var(--text-secondary);
            margin: 0;
            font-size: 0.95rem;
        }

        /* Loading Overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 10, 15, 0.9);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .loading-overlay.hidden {
            display: none;
        }

        .loading-text {
            color: var(--text-primary);
            margin-top: 1rem;
            font-size: 1.1rem;
        }

        /* Architecture Diagram */
        .architecture-box {
            background: rgba(139, 127, 255, 0.08);
            border: 1px solid var(--border-primary);
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            font-family: 'Fira Code', monospace;
            font-size: 0.85rem;
            line-height: 1.8;
            color: var(--text-secondary);
            overflow-x: auto;
        }

        .architecture-box .highlight {
            color: #51cf66;
        }

        .architecture-box .accent {
            color: var(--accent-primary);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sim-hero {
                padding: 2rem 1.5rem;
            }

            .sim-hero h1 {
                font-size: 1.8rem;
            }

            .file-header {
                padding: 1rem;
            }

            .file-info {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }

            .file-stats {
                flex-wrap: wrap;
                gap: 0.75rem;
            }
        }
    </style>

    <!-- Tooltip System CSS -->
    <link rel="stylesheet" href="css/pm-tooltip.css">
    <link rel="stylesheet" href="css/formula-hover.css">
</head>
<body class="auth-loading">
    <div id="main-content" style="display: none;">
        <header>
            <div class="header-content">
                <div class="site-title" style="font-size: 1.5rem; font-weight: 700; color: var(--text-primary);">
                    <a href="index.html" style="text-decoration: none; color: inherit;">Principia Metaphysica</a>
                </div>
                <nav>
                    <ul>
                        <li><a href="index.html">Home</a></li>
                        <li><a href="beginners-guide.html">Beginner's Guide</a></li>
                        <li><a href="sections/index.html">Sections</a></li>
                        <li><a href="foundations/index.html">Foundations</a></li>
                        <li><a href="references.html">References</a></li>
                        <li><a href="principia-metaphysica-paper.html">Paper</a></li>
                        <li class="user-controls-nav">
                            <div class="user-controls">
                                <img id="user-avatar" src="/images/default-avatar.svg" alt="User">
                                <span id="user-email"></span>
                                <button id="logout-btn">Logout</button>
                            </div>
                            <button id="header-login-btn" class="header-login-btn">
                                <img src="/images/google-icon.svg" alt="G" class="google-icon-small">
                                Login
                            </button>
                        </li>
                    </ul>
                </nav>
            </div>
        </header>

        <main>
            <!-- Hero Section -->
            <section class="sim-hero">
                <h1>Simulation Framework</h1>
                <p class="lead">
                    The Principia Metaphysica simulation suite provides rigorous numerical validation of the
                    theoretical framework. Written in Python, these simulations compute observable predictions
                    from first principles, validate consistency across all parameter derivations, and compare
                    results against experimental data from PDG, NuFIT, DESI, and other sources.
                </p>
                <div class="architecture-box">
<span class="highlight">SIMULATION ARCHITECTURE</span>

<span class="accent">config.py</span>                  Single source of truth for all parameters
    |
    v
<span class="accent">run_all_simulations.py</span>    Master orchestrator - runs all canonical simulations
    |
    +---> <span class="accent">simulations/*.py</span>      Individual physics modules (v13.0-v15.x)
    |
    v
<span class="accent">theory_output.json</span>        Machine-readable results with validation status
    |
    v
<span class="accent">theory-constants-enhanced.js</span>  Website integration layer

<span class="highlight">DESIGN PRINCIPLES:</span>
- Single Source of Truth: All parameters derive from config.py
- No Duplicates: Each observable computed exactly once
- Experimental Validation: All outputs checked against PDG/NuFIT/DESI
- Geometric Derivation: Parameters emerge from G2 structure, not fitting
                </div>
            </section>

            <!-- Dynamic Index -->
            <section class="sim-index">
                <h2>File Index</h2>
                <div id="index-container" class="index-grid">
                    <div class="index-category">
                        <h3>Core Framework</h3>
                        <ul id="core-files-list">
                            <li><span class="index-link" data-file="config.py">config.py</span></li>
                            <li><span class="index-link" data-file="run_all_simulations.py">run_all_simulations.py</span></li>
                            <li><span class="index-link" data-file="theory_output.json">theory_output.json</span></li>
                            <li><span class="index-link" data-file="theory-constants-enhanced.js">theory-constants-enhanced.js</span></li>
                        </ul>
                    </div>
                    <div class="index-category">
                        <h3>Simulation Modules</h3>
                        <ul id="simulation-files-list">
                            <li class="file-loading"><span class="spinner"></span>Loading...</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- Core Files Section -->
            <div class="category-header">
                <h2>Core Framework Files</h2>
                <p>Central configuration and orchestration files that define the simulation architecture</p>
            </div>

            <div id="core-files-container">
                <!-- config.py -->
                <div class="file-section" id="section-config.py">
                    <div class="file-header" onclick="toggleSection('config.py')">
                        <div class="file-info">
                            <div class="file-icon">py</div>
                            <div>
                                <div class="file-name">config.py</div>
                                <div class="file-path">Single source of truth for all PM parameters</div>
                            </div>
                        </div>
                        <span class="expand-icon">&#x25BC;</span>
                    </div>
                    <div class="file-content">
                        <div class="file-loading"><span class="spinner"></span>Loading file content...</div>
                    </div>
                </div>

                <!-- run_all_simulations.py -->
                <div class="file-section" id="section-run_all_simulations.py">
                    <div class="file-header" onclick="toggleSection('run_all_simulations.py')">
                        <div class="file-info">
                            <div class="file-icon">py</div>
                            <div>
                                <div class="file-name">run_all_simulations.py</div>
                                <div class="file-path">Master orchestrator for all canonical simulations</div>
                            </div>
                        </div>
                        <span class="expand-icon">&#x25BC;</span>
                    </div>
                    <div class="file-content">
                        <div class="file-loading"><span class="spinner"></span>Loading file content...</div>
                    </div>
                </div>

                <!-- theory_output.json -->
                <div class="file-section" id="section-theory_output.json">
                    <div class="file-header" onclick="toggleSection('theory_output.json')">
                        <div class="file-info">
                            <div class="file-icon json">{ }</div>
                            <div>
                                <div class="file-name">theory_output.json</div>
                                <div class="file-path">Machine-readable simulation results</div>
                            </div>
                        </div>
                        <span class="expand-icon">&#x25BC;</span>
                    </div>
                    <div class="file-content">
                        <div class="file-loading"><span class="spinner"></span>Loading file content...</div>
                    </div>
                </div>

                <!-- theory-constants-enhanced.js -->
                <div class="file-section" id="section-theory-constants-enhanced.js">
                    <div class="file-header" onclick="toggleSection('theory-constants-enhanced.js')">
                        <div class="file-info">
                            <div class="file-icon js">JS</div>
                            <div>
                                <div class="file-name">theory-constants-enhanced.js</div>
                                <div class="file-path">Website integration layer for dynamic values</div>
                            </div>
                        </div>
                        <span class="expand-icon">&#x25BC;</span>
                    </div>
                    <div class="file-content">
                        <div class="file-loading"><span class="spinner"></span>Loading file content...</div>
                    </div>
                </div>
            </div>

            <!-- Simulation Modules Section -->
            <div class="category-header">
                <h2>Simulation Modules</h2>
                <p>Individual physics simulations implementing specific aspects of the PM framework</p>
            </div>

            <div id="simulation-files-container">
                <div class="file-loading" id="simulations-loading">
                    <span class="spinner"></span>Loading simulation files from repository...
                </div>
            </div>

        </main>

        <footer>
            <div class="footer-content">
                <p>&copy; 2025 Andrew Keith Watts. All rights reserved.</p>
                <p>Principia Metaphysica - A Unified Geometric Theory</p>
            </div>
        </footer>
    </div>

    <!-- Prism.js for syntax highlighting -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-json.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.js"></script>

    <script>
        // GitHub API configuration
        const GITHUB_REPO = 'andrewkwatts-maker/PrincipiaMetaphysica';
        const GITHUB_BRANCH = 'main';
        const GITHUB_RAW_BASE = `https://raw.githubusercontent.com/${GITHUB_REPO}/${GITHUB_BRANCH}`;
        const GITHUB_API_BASE = `https://api.github.com/repos/${GITHUB_REPO}/contents`;

        // File cache
        const fileCache = new Map();

        // Core files configuration
        const CORE_FILES = [
            { name: 'config.py', path: 'config.py', language: 'python' },
            { name: 'run_all_simulations.py', path: 'run_all_simulations.py', language: 'python' },
            { name: 'theory_output.json', path: 'theory_output.json', language: 'json' },
            { name: 'theory-constants-enhanced.js', path: 'theory-constants-enhanced.js', language: 'javascript' }
        ];

        // Simulation file descriptions
        const SIM_DESCRIPTIONS = {
            'moduli_racetrack_stabilization': 'Racetrack superpotential for moduli stabilization',
            'g2_metric_ricci_validator': 'G2 metric Ricci-flatness validation',
            'g2_yukawa_overlap_integrals': '7D Monte Carlo Yukawa coupling integrals',
            'pneuma_bridge': 'Pneuma-vielbein emergence bridge',
            'multi_sector_sampling': 'Multi-sector blended vacuum sampling',
            'fermion_chirality_generations': 'Fermion chirality and generations',
            'proton_decay_geometric': 'Geometric proton decay predictions',
            'breaking_chain_geometric': 'E8 -> SO(10) -> SM breaking chain',
            'doublet_triplet_splitting': 'Doublet-triplet splitting mechanism',
            'kk_spectrum_full': 'Full Kaluza-Klein spectrum',
            'wz_evolution_desi_dr2': 'Dark energy w(z) evolution (DESI DR2)',
            'pmns_full_matrix': 'Full PMNS neutrino mixing matrix',
            'neutrino_mass_ordering': 'Neutrino mass ordering predictions',
            'microtubule_threshold': 'Orch OR microtubule threshold model',
            'photosynthetic_threshold': 'Photosynthetic quantum coherence',
            'biological_quantum_threshold': 'Unified biological quantum thresholds',
            'microtubule_temperature': 'Temperature-dependent Orch OR decoherence',
            'pneuma_racetrack_stability': 'Pneuma field racetrack stability',
            'asymptotic_safety': 'Asymptotic safety UV completion'
        };

        // Get description for a simulation file
        function getSimDescription(filename) {
            const baseName = filename.replace('.py', '').replace(/_v\d+_?\d*/g, '');
            return SIM_DESCRIPTIONS[baseName] || 'Physics simulation module';
        }

        // Toggle section expansion
        function toggleSection(filename) {
            const section = document.getElementById(`section-${filename}`);
            if (!section) return;

            const isExpanded = section.classList.contains('expanded');

            if (isExpanded) {
                section.classList.remove('expanded');
            } else {
                section.classList.add('expanded');
                loadFileContent(filename);
            }
        }

        // Scroll to section
        function scrollToSection(filename) {
            const section = document.getElementById(`section-${filename}`);
            if (section) {
                section.scrollIntoView({ behavior: 'smooth', block: 'start' });
                // Expand after scrolling
                setTimeout(() => {
                    if (!section.classList.contains('expanded')) {
                        toggleSection(filename);
                    }
                }, 300);
            }
        }

        // Load file content from GitHub
        async function loadFileContent(filename) {
            const section = document.getElementById(`section-${filename}`);
            if (!section) return;

            const contentDiv = section.querySelector('.file-content');

            // Check cache first
            if (fileCache.has(filename)) {
                displayFileContent(contentDiv, filename, fileCache.get(filename));
                return;
            }

            // Show loading state
            contentDiv.innerHTML = '<div class="file-loading"><span class="spinner"></span>Loading file content...</div>';

            try {
                // Determine file path
                let filePath = filename;
                if (!CORE_FILES.find(f => f.name === filename)) {
                    filePath = `simulations/${filename}`;
                }

                const response = await fetch(`${GITHUB_RAW_BASE}/${filePath}`);
                if (!response.ok) {
                    throw new Error(`Failed to load file: ${response.status}`);
                }

                const content = await response.text();
                fileCache.set(filename, content);
                displayFileContent(contentDiv, filename, content);

            } catch (error) {
                contentDiv.innerHTML = `<div class="file-error">Error loading file: ${error.message}</div>`;
            }
        }

        // Display file content with syntax highlighting
        function displayFileContent(contentDiv, filename, content) {
            // Determine language
            let language = 'python';
            if (filename.endsWith('.json')) language = 'json';
            if (filename.endsWith('.js')) language = 'javascript';

            // Count lines
            const lines = content.split('\n').length;
            const size = new Blob([content]).size;
            const sizeStr = size > 1024 ? `${(size / 1024).toFixed(1)} KB` : `${size} bytes`;

            contentDiv.innerHTML = `
                <div class="code-wrapper">
                    <pre class="line-numbers"><code class="language-${language}">${escapeHtml(content)}</code></pre>
                </div>
                <div class="file-stats">
                    <span>Lines: ${lines}</span>
                    <span>Size: ${sizeStr}</span>
                    <span>Language: ${language}</span>
                </div>
            `;

            // Apply Prism highlighting
            Prism.highlightAllUnder(contentDiv);
        }

        // Escape HTML entities
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Load simulation files list from GitHub
        async function loadSimulationFiles() {
            const container = document.getElementById('simulation-files-container');
            const indexList = document.getElementById('simulation-files-list');

            try {
                const response = await fetch(`${GITHUB_API_BASE}/simulations`);
                if (!response.ok) {
                    throw new Error(`GitHub API error: ${response.status}`);
                }

                const files = await response.json();

                // Filter for .py files only (not deprecated)
                const pyFiles = files
                    .filter(f => f.name.endsWith('.py') && f.type === 'file')
                    .sort((a, b) => {
                        // Sort by version (v15 first, then v14, etc.)
                        const versionA = a.name.match(/v(\d+)/)?.[1] || '0';
                        const versionB = b.name.match(/v(\d+)/)?.[1] || '0';
                        if (versionA !== versionB) return parseInt(versionB) - parseInt(versionA);
                        return a.name.localeCompare(b.name);
                    });

                // Update index list
                indexList.innerHTML = pyFiles.map(f =>
                    `<li><span class="index-link" onclick="scrollToSection('${f.name}')">${f.name}</span></li>`
                ).join('');

                // Create file sections
                container.innerHTML = pyFiles.map(f => `
                    <div class="file-section" id="section-${f.name}">
                        <div class="file-header" onclick="toggleSection('${f.name}')">
                            <div class="file-info">
                                <div class="file-icon">py</div>
                                <div>
                                    <div class="file-name">${f.name}</div>
                                    <div class="file-path">${getSimDescription(f.name)}</div>
                                </div>
                            </div>
                            <span class="expand-icon">&#x25BC;</span>
                        </div>
                        <div class="file-content">
                            <div class="file-loading"><span class="spinner"></span>Loading file content...</div>
                        </div>
                    </div>
                `).join('');

            } catch (error) {
                container.innerHTML = `<div class="file-error">Error loading simulation files: ${error.message}<br><small>The GitHub API may be rate-limited. Please try again later.</small></div>`;
                indexList.innerHTML = '<li class="file-error">Failed to load</li>';
            }
        }

        // Initialize index link clicks
        function initIndexLinks() {
            document.querySelectorAll('.index-link[data-file]').forEach(link => {
                link.addEventListener('click', () => {
                    scrollToSection(link.dataset.file);
                });
            });
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', () => {
            loadSimulationFiles();
            initIndexLinks();

            // Show main content (auth system will handle this normally)
            const mainContent = document.getElementById('main-content');
            if (mainContent) {
                mainContent.style.display = 'block';
                document.body.classList.remove('auth-loading');
            }
        });
    </script>

    <!-- Auth system integration -->
    <script type="module">
        import { setupAuthGuard } from './js/auth-guard.js';
        setupAuthGuard('simulations');
    </script>

    <!-- Tooltip System -->
    <script src="theory-constants-enhanced.js"></script>
    <script src="js/pm-tooltip-system.js"></script>
    <script src="js/pm-formula-loader.js"></script>
</body>
</html>
