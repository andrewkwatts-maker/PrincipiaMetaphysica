<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test References Loading</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 2rem auto;
            padding: 0 1rem;
            background: #1a1a1a;
            color: #f0f0f0;
        }
        h1 {
            color: #8b7fff;
        }
        .status {
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 8px;
            border-left: 4px solid;
        }
        .loading {
            background: rgba(255, 255, 255, 0.05);
            border-left-color: #8b7fff;
        }
        .success {
            background: rgba(80, 200, 120, 0.1);
            border-left-color: #50c878;
        }
        .error {
            background: rgba(255, 100, 100, 0.1);
            border-left-color: #ff6464;
        }
        .info {
            background: rgba(139, 127, 255, 0.1);
            border-left-color: #8b7fff;
            font-size: 0.9rem;
            margin-top: 2rem;
        }
        code {
            background: rgba(255, 255, 255, 0.1);
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
        }
        .reference {
            padding: 0.75rem;
            margin: 0.5rem 0;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 6px;
            border-left: 3px solid #8b7fff;
        }
        .reference-title {
            font-weight: bold;
            color: #8b7fff;
        }
        .reference-authors {
            color: #aaa;
            font-size: 0.9rem;
        }
        .reference-year {
            color: #888;
            font-size: 0.85rem;
            font-style: italic;
        }
        #console-log {
            background: #000;
            color: #0f0;
            padding: 1rem;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 2rem;
        }
        .console-line {
            margin: 0.25rem 0;
        }
        .console-error {
            color: #ff6464;
        }
        .console-warn {
            color: #ffaa00;
        }
        .console-success {
            color: #50c878;
        }
    </style>
</head>
<body>
    <h1>Test References Loading</h1>

    <div class="info">
        <strong>Test Purpose:</strong> Verify that <code>AutoGenerated/references.json</code> can be loaded from this location.
        <br><br>
        <strong>Current Location:</strong> <code id="current-location"></code>
    </div>

    <div id="status" class="status loading">
        ⟳ Loading references from AutoGenerated/references.json...
    </div>

    <div id="references-container"></div>

    <h2>Console Log</h2>
    <div id="console-log"></div>

    <script>
        // Console logging
        const consoleLog = document.getElementById('console-log');
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;

        function addToConsole(message, type = 'log') {
            const line = document.createElement('div');
            line.className = `console-line console-${type}`;
            line.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            consoleLog.appendChild(line);
            consoleLog.scrollTop = consoleLog.scrollHeight;
        }

        console.log = function(...args) {
            originalLog.apply(console, args);
            addToConsole(args.join(' '), 'log');
        };

        console.error = function(...args) {
            originalError.apply(console, args);
            addToConsole(args.join(' '), 'error');
        };

        console.warn = function(...args) {
            originalWarn.apply(console, args);
            addToConsole(args.join(' '), 'warn');
        };

        // Display current location
        document.getElementById('current-location').textContent = window.location.href;

        // Test loading references
        async function testLoadReferences() {
            console.log('Starting references loading test...');
            console.log('Current URL:', window.location.href);
            console.log('Current pathname:', window.location.pathname);

            // Try multiple paths
            const paths = [
                'AutoGenerated/references.json',
                './AutoGenerated/references.json',
                '/AutoGenerated/references.json',
                '../AutoGenerated/references.json'
            ];

            let data = null;
            let successPath = null;

            for (const path of paths) {
                try {
                    console.log(`Attempting to fetch from: ${path}`);
                    const response = await fetch(path);
                    console.log(`Response status for ${path}: ${response.status} ${response.statusText}`);

                    if (response.ok) {
                        const text = await response.text();
                        console.log(`✓ Fetched ${text.length} bytes from ${path}`);

                        data = JSON.parse(text);
                        successPath = path;
                        console.log(`✓ Successfully parsed JSON from ${path}`);
                        console.log(`✓ Found ${Object.keys(data).length} references`);
                        break;
                    }
                } catch (fetchError) {
                    console.warn(`Failed to fetch from ${path}: ${fetchError.message}`);
                }
            }

            const statusDiv = document.getElementById('status');
            const refsContainer = document.getElementById('references-container');

            if (!data) {
                statusDiv.className = 'status error';
                statusDiv.innerHTML = `
                    <strong>❌ Error loading references</strong><br>
                    Could not load from any path. Tried:<br>
                    ${paths.map(p => `<code>${p}</code>`).join(', ')}<br><br>
                    <strong>Troubleshooting:</strong><br>
                    • Make sure you're viewing this page through a web server (not file://)<br>
                    • Check that AutoGenerated/references.json exists<br>
                    • Check browser console for CORS or network errors
                `;
                console.error('Failed to load references from any path');
                return;
            }

            // Success!
            statusDiv.className = 'status success';
            statusDiv.innerHTML = `
                <strong>✅ Successfully loaded references!</strong><br>
                Path: <code>${successPath}</code><br>
                Total references: <strong>${Object.keys(data).length}</strong>
            `;

            // Display some sample references
            const refKeys = Object.keys(data);
            const sampleSize = Math.min(5, refKeys.length);

            let html = `<h2>Sample References (showing ${sampleSize} of ${refKeys.length})</h2>`;

            for (let i = 0; i < sampleSize; i++) {
                const ref = data[refKeys[i]];
                const citations = (ref.citedByFormulas?.length || 0) + (ref.citedByParams?.length || 0);

                html += `
                    <div class="reference">
                        <div class="reference-title">${ref.title}</div>
                        <div class="reference-authors">${ref.authors}</div>
                        <div class="reference-year">${ref.year} • ${citations} citations</div>
                    </div>
                `;
            }

            refsContainer.innerHTML = html;

            // Log statistics
            const withArxiv = refKeys.filter(k => data[k].arxiv && data[k].arxiv.length > 0).length;
            const withDOI = refKeys.filter(k => data[k].doi && data[k].doi.length > 0).length;
            const withCitations = refKeys.filter(k => {
                const ref = data[k];
                return (ref.citedByFormulas?.length || 0) + (ref.citedByParams?.length || 0) > 0;
            }).length;

            console.log(`\nStatistics:`);
            console.log(`  Total: ${refKeys.length}`);
            console.log(`  With arXiv: ${withArxiv}`);
            console.log(`  With DOI: ${withDOI}`);
            console.log(`  With citations: ${withCitations}`);
        }

        // Run test on page load
        document.addEventListener('DOMContentLoaded', testLoadReferences);
    </script>
</body>
</html>
