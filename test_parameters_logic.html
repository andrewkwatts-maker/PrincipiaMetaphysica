<!DOCTYPE html>
<html>
<head>
    <title>Test Parameters Logic</title>
</head>
<body>
    <h1>Testing Parameters.html Logic</h1>
    <pre id="output"></pre>

    <script>
        // Copy the test data structure from parameters.json
        const testData = {
            "version": "14.1",
            "dimensions": {
                "D_BULK": 26,
                "D_AFTER_SP2R": 13,
                "M_PLANCK": 2.435e+18
            },
            "neutrino": {
                "pmns_angles": {
                    "theta_12": {
                        "predicted": 33.59,
                        "predicted_error": 1.18,
                        "experimental": 33.41,
                        "experimental_error": 0.75,
                        "units": "degrees",
                        "derivation": "From tri-bimaximal + G₂ perturbation",
                        "source": "NuFIT 6.0 (2024)",
                        "status": "DERIVED"
                    }
                },
                "mass_spectrum": {
                    "m_nu_1": 0.001,
                    "m_nu_2": 0.009,
                    "m_nu_3": 0.05,
                    "sum_m_nu": 0.06,
                    "units": "eV",
                    "hierarchy": "Normal"
                }
            }
        };

        let output = [];

        // Test isParameter function
        function isParameter(value) {
            if (typeof value !== 'object' || value === null) {
                return typeof value === 'number' || typeof value === 'string';
            }

            if (Array.isArray(value)) {
                return true;
            }

            const paramFields = ['value', 'predicted', 'experimental', 'units', 'status', 'description', 'derivation', 'source'];
            const hasParamField = paramFields.some(field => field in value);

            if (hasParamField) {
                return true;
            }

            const values = Object.values(value);
            if (values.length > 0) {
                const allPrimitive = values.every(v =>
                    typeof v === 'number' ||
                    typeof v === 'string' ||
                    typeof v === 'boolean'
                );
                if (allPrimitive || (values.some(v => typeof v === 'number') && hasParamField)) {
                    return false;
                }
            }

            return false;
        }

        // Test processCategory
        function processCategory(category, params, parentKey = '') {
            for (const [key, value] of Object.entries(params)) {
                const fullKey = parentKey ? `${parentKey}.${key}` : key;

                if (isParameter(value)) {
                    output.push(`✓ Parameter found: ${category}.${fullKey} = ${JSON.stringify(value).substring(0, 50)}...`);
                } else if (typeof value === 'object' && value !== null && !Array.isArray(value)) {
                    output.push(`→ Container: ${category}.${fullKey} (drilling down...)`);
                    processCategory(category, value, fullKey);
                }
            }
        }

        // Process test data
        for (const [category, params] of Object.entries(testData)) {
            if (category === 'version') continue;

            output.push(`\n=== Category: ${category} ===`);
            processCategory(category, params);
        }

        // Display results
        document.getElementById('output').textContent = output.join('\n');
    </script>
</body>
</html>
